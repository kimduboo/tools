<!doctype html>
<html lang="ko" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>한영타 변환기 | Tool Box</title>
  <meta name="description" content="영문 자판으로 친 한글(예: dkssud → 안녕)과 한글 → 영문 자판을 자동으로 인식해 실시간 변환합니다." />
  <link rel="icon" href="data:image/svg+xml,<svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'><text y='0.9em' font-size='80'>⌨️</text></svg>">
  <link rel="stylesheet" href="styles.css" />
  <script src="ads.js" defer></script>
</head>
<body>
  <div class="wrap">
    <header class="app-header">
      <a class="brand" href="/" aria-label="Tool Box 홈">
        <div class="logo"><span class="logo-text">Tool<br>Box</span></div>
      </a>
      <div class="title">
        <h1>한영타 변환기</h1>
        <p>자동 인식 · 실시간 변환</p>
      </div>
      <nav class="actions" aria-hidden="true"></nav>
    </header>

    <!-- 입력 & 결과가 하나의 카드 안에서 -->
    <section class="card center" aria-labelledby="inTitle">
      <h2 id="inTitle">입력</h2>

      <div class="field">
        <label for="src">텍스트</label>
        <textarea id="src" rows="6" placeholder="예) dkssud dlf → 안녕 하세요"></textarea>
        <small class="muted" id="modeHint" style="margin-top:6px;display:block">자동 인식 대기…</small>
      </div>

      <div class="row" style="gap:10px">
        <button id="convertBtn" class="btn primary" style="flex:2">변환하기</button>
        <button id="resetBtn" class="btn" style="flex:1">초기화</button>
      </div>

      <!-- (선택) 입력 아래 광고 슬롯 -->
      <section class="ad-slot" id="ad-under-input" style="margin-top:12px">
        <ins class="adsbygoogle" style="display:block"
             data-ad-client="ca-pub-6022794906780783"
             data-ad-slot="6135885040"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
      </section>

      <!-- 결과 (같은 카드 내부, 버튼 아래) -->
      <div class="result-wrap" id="resultWrap" style="margin-top:18px">
        <div class="muted" id="now">기준 시각: -</div>

        <div class="headline" style="justify-content:center; margin-top:8px; position:relative">
          <span id="mainLine" class="copyable" aria-live="polite">-</span>
          <button class="btn small" id="copyMain" style="position:absolute;right:12px">복사</button>
        </div>

        <div class="kpi-line" style="margin-top:12px">
          <span class="muted">입력</span>
          <div style="display:flex;align-items:center;gap:10px">
            <b id="srcText">-</b>
            <button class="btn small" data-copy="srcText">복사</button>
          </div>
        </div>

        <div class="kpi-line" style="margin-top:12px">
          <span class="muted">변환</span>
          <div style="display:flex;align-items:center;gap:10px">
            <b id="dstText">-</b>
            <button class="btn small" data-copy="dstText">복사</button>
          </div>
        </div>

        <div class="muted" style="font-size:12px;margin-top:6px">
          ※ 2-벌식 자판 기준. 대문자(Q/W/E/R/T)=ㅃ/ㅉ/ㄸ/ㄲ/ㅆ.
        </div>
      </div>
    </section>

    <footer><p>© <span id="year"></span> Tool Box</p></footer>
  </div>

  <script>
    // 공통 시각/푸터
    const KST='Asia/Seoul';
    const fmtNow=new Intl.DateTimeFormat('ko-KR',{timeZone:KST,year:'numeric',month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'});
    document.getElementById('year').textContent=new Date().getFullYear();

    // ===== 키배치/자모표 =====
    const key2Jamo = {
      q:'ㅂ', w:'ㅈ', e:'ㄷ', r:'ㄱ', t:'ㅅ', y:'ㅛ', u:'ㅕ', i:'ㅑ', o:'ㅐ', p:'ㅔ',
      a:'ㅁ', s:'ㄴ', d:'ㅇ', f:'ㄹ', g:'ㅎ', h:'ㅗ', j:'ㅓ', k:'ㅏ', l:'ㅣ',
      z:'ㅋ', x:'ㅌ', c:'ㅊ', v:'ㅍ', b:'ㅠ', n:'ㅜ', m:'ㅡ',
      Q:'ㅃ', W:'ㅉ', E:'ㄸ', R:'ㄲ', T:'ㅆ', O:'ㅒ', P:'ㅖ'
    };
    const jamo2Key = Object.fromEntries(Object.entries(key2Jamo).map(([k,v])=>[v,k]));

    const CHO = ["ㄱ","ㄲ","ㄴ","ㄷ","ㄸ","ㄹ","ㅁ","ㅂ","ㅃ","ㅅ","ㅆ","ㅇ","ㅈ","ㅉ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"];
    const JUNG= ["ㅏ","ㅐ","ㅑ","ㅒ","ㅓ","ㅔ","ㅕ","ㅖ","ㅗ","ㅘ","ㅙ","ㅚ","ㅛ","ㅜ","ㅝ","ㅞ","ㅟ","ㅠ","ㅡ","ㅢ","ㅣ"];
    const JONG= ["","ㄱ","ㄲ","ㄳ","ㄴ","ㄵ","ㄶ","ㄷ","ㄹ","ㄺ","ㄻ","ㄼ","ㄽ","ㄾ","ㄿ","ㅀ","ㅁ","ㅂ","ㅄ","ㅅ","ㅆ","ㅇ","ㅈ","ㅊ","ㅋ","ㅌ","ㅍ","ㅎ"];
    const V_COMBO = {"ㅗㅏ":"ㅘ","ㅗㅐ":"ㅙ","ㅗㅣ":"ㅚ","ㅜㅓ":"ㅝ","ㅜㅔ":"ㅞ","ㅜㅣ":"ㅟ","ㅡㅣ":"ㅢ"};
    const F_COMBO = {"ㄱㅅ":"ㄳ","ㄴㅈ":"ㄵ","ㄴㅎ":"ㄶ","ㄹㄱ":"ㄺ","ㄹㅁ":"ㄻ","ㄹㅂ":"ㄼ","ㄹㅅ":"ㄽ","ㄹㅌ":"ㄾ","ㄹㅍ":"ㄿ","ㄹㅎ":"ㅀ","ㅂㅅ":"ㅄ"};

    // 영→한
    function engToKor(str){
      const jamos = [...str].map(ch => key2Jamo[ch] ?? ch);
      const out=[]; let cho=null, jung=null, jong=null;
      const flush=()=>{
        if(cho!==null && jung!==null){
          const choI=CHO.indexOf(cho), jungI=JUNG.indexOf(jung), jongI=JONG.indexOf(jong??"");
          if(choI>-1 && jungI>-1 && jongI>-1){
            out.push(String.fromCharCode(0xAC00 + (choI*21 + jungI)*28 + jongI));
          }else{
            if(cho) out.push(cho); if(jung) out.push(jung); if(jong) out.push(jong);
          }
        }else{
          if(cho) out.push(cho); if(jung) out.push(jung); if(jong) out.push(jong);
        }
        cho=jung=jong=null;
      };
      for(const cur of jamos){
        const isV = "ㅏㅐㅑㅒㅓㅔㅕㅖㅗㅛㅜㅠㅡㅣ".includes(cur);
        const isJ = "ㄱㄲㄴㄷㄸㄹㅁㅂㅃㅅㅆㅇㅈㅉㅊㅋㅌㅍㅎ".includes(cur);
        if(!isV && !isJ && !Object.values(V_COMBO).includes(cur) && !Object.values(F_COMBO).includes(cur)){ flush(); out.push(cur); continue; }
        if(isV){
          if(cho===null){ flush(); jung=cur; }
          else if(jung===null){ jung=cur; }
          else if(jong!==null){ flush(); jung=cur; }
          else{ const comb=V_COMBO[jung+cur]; if(comb) jung=comb; else { flush(); jung=cur; } }
        }else{ // 자음
          if(jung===null){
            if(cho===null) cho=cur;
            else { flush(); cho=cur; }
          }else{
            if(jong===null) jong=cur;
            else{ const comb=F_COMBO[jong+cur]; if(comb) jong=comb; else { flush(); cho=cur; } }
          }
        }
      }
      flush();
      return out.join('');
    }

    // 한→영
    function korToEng(str){
      const res=[];
      for(const ch of str){
        const code=ch.charCodeAt(0);
        if(code>=0xAC00 && code<=0xD7A3){
          const s=code-0xAC00, cho=Math.floor(s/28/21), jung=Math.floor((s/28)%21), jong=s%28;
          const pushJ=(j)=>{ res.push(jamo2Key[j]??j); };
          const deV=(idx)=>{
            const v=JUNG[idx]; const pair=Object.entries(V_COMBO).find(([k,vv])=>vv===v);
            if(pair){ pushJ(pair[0][0]); pushJ(pair[0][1]); } else pushJ(v);
          };
          const deF=(idx)=>{
            const j=JONG[idx]; const pair=Object.entries(F_COMBO).find(([k,vv])=>vv===j);
            if(pair){ pushJ(pair[0][0]); pushJ(pair[0][1]); } else if(j) pushJ(j);
          };
          pushJ(CHO[cho]); deV(jung); deF(jong);
        }else{
          res.push(jamo2Key[ch]??ch);
        }
      }
      return res.join('');
    }

    // 자동 인식: 한글 존재→한→영, 영문(a-zA-Z) 많으면 영→한
    const reHangul=/[\uAC00-\uD7A3\u3130-\u318F]/;
    const reAlpha=/[A-Za-z]/;

    function detectMode(text){
      const h = (text.match(reHangul)||[]).length;
      const a = (text.match(reAlpha)||[]).length;
      if(h && !a) return 'k2e';
      if(a && !h) return 'e2k';
      if(h && a)  return h>=a ? 'k2e' : 'e2k';
      return 'e2k';
    }

    const src = document.getElementById('src');
    const resultWrap = document.getElementById('resultWrap');
    const mainLine = document.getElementById('mainLine');
    const srcText = document.getElementById('srcText');
    const dstText = document.getElementById('dstText');
    const modeHint = document.getElementById('modeHint');

    function convertNow(){
      const text = src.value;
      if(!text.trim()){
        modeHint.textContent='자동 인식 대기…';
        resultWrap.style.display='none';
        return;
      }
      const mode = detectMode(text);
      modeHint.textContent = mode==='e2k' ? '자동 인식: 영 → 한' : '자동 인식: 한 → 영';
      const out = mode==='e2k' ? engToKor(text) : korToEng(text);
      mainLine.textContent = out;
      srcText.textContent  = text;
      dstText.textContent  = out;
      resultWrap.style.display='block';
      document.getElementById('now').textContent=`기준 시각: ${fmtNow.format(new Date())} (KST)`;
    }

    // 실시간 변환(디바운스)
    let t;
    src.addEventListener('input', ()=>{ clearTimeout(t); t=setTimeout(convertNow, 120); });

    // 버튼 동작(즉시 변환)
    document.getElementById('convertBtn').addEventListener('click', convertNow);
    document.getElementById('resetBtn').addEventListener('click', ()=>{
      src.value=''; convertNow();
    });

    // 복사
    document.getElementById('copyMain').addEventListener('click', ()=>{
      navigator.clipboard.writeText(mainLine.textContent||'');
    });
    document.querySelectorAll('[data-copy]').forEach(b=>b.addEventListener('click',()=> {
      const t = document.getElementById(b.dataset.copy)?.textContent?.trim() ?? '';
      navigator.clipboard.writeText(t);
    }));

    // 최초 렌더 & 광고
    convertNow();
    (window.adsbygoogle = window.adsbygoogle || []).push({});
  </script>
</body>
</html>