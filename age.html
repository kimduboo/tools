<!doctype html>
<html lang="ko" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>ë§Œë‚˜ì´(ìƒí™œì—°ë ¹) ê³„ì‚°ê¸° | Tool Box</title>
  <!-- ë§Œë‚˜ì´ ê³„ì‚°ê¸° íŒŒë¹„ì½˜ (ìƒì¼ ì¼€ì´í¬ ğŸ‚) -->
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='18' fill='%23ffffff'/%3E%3Ctext x='50' y='70' font-size='60' text-anchor='middle'%3EğŸ‚%3C/text%3E%3C/svg%3E"/>

  <meta name="description" content="ìƒë…„ì›”ì¼ì„ ì…ë ¥í•˜ë©´ KST ê¸°ì¤€ìœ¼ë¡œ ë§Œë‚˜ì´, ë‹¤ìŒ ìƒì¼ê¹Œì§€ D-Day, ì‚´ì•„ì˜¨ ë‚ , ê°œì›”ìˆ˜ í‘œê¸°ë¥¼ ì œê³µí•©ë‹ˆë‹¤." />
  <script src="ads.js"></script>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="wrap">
    <header>
      <!-- ë¡œê³ ë¥¼ í™ˆ ë§í¬ë¡œ -->
      <a class="brand" href="https://tools.joyful101.com/" aria-label="Tool Box í™ˆ">
        <div class="logo" aria-hidden="true">
          <span class="logo-text">Tool<br>Box</span>
        </div>
      </a>
      <div class="title">
        <h1>ë§Œë‚˜ì´(ìƒí™œì—°ë ¹) ê³„ì‚°ê¸°</h1>
        <p>ê²°ê³¼ ì˜ˆ: ë§Œ4ì„¸/49ê°œì›”/4ì„¸1ê°œì›”/4;1</p>
      </div>
      <div class="spacer" aria-hidden="true"></div>
    </header>

    <main class="age-main">
      <!-- ì…ë ¥ ì¹´ë“œ -->
      <section class="card" aria-labelledby="calcTitle">
        <h2 id="calcTitle">ì…ë ¥</h2>

        <div class="field">
          <label for="dob">ìƒë…„ì›”ì¼</label>
          <div class="datebox">
            <input id="dob" type="text" placeholder="YYYY-MM-DD" maxlength="10" inputmode="numeric" autocomplete="off" aria-describedby="dobHelp" />
            <button type="button" class="calbtn" id="openCal" aria-label="ë‹¬ë ¥ ì—´ê¸°">ğŸ“…</button>
            <div class="picker" id="picker" role="dialog" aria-modal="false" aria-label="ë‹¬ë ¥ ì„ íƒê¸°"></div>
            <div id="dobHelp" class="muted" style="font-size:12px;margin-top:6px">ì˜ˆ: 20251209 â†’ 2025-12-09ë¡œ ìë™ í¬ë§·</div>
          </div>
        </div>

        <div class="actions">
          <button id="calcBtn" class="btn primary">ê³„ì‚°í•˜ê¸°</button>
          <button id="resetBtn" class="btn">ì´ˆê¸°í™”</button>
        </div>
        <p></p>

        <div class="ad-slot" id="adTop">
          <!-- ì¤‘ê°„ ìˆ˜í‰ ë””ìŠ¤í”Œë ˆì´ -->
          <ins class="adsbygoogle"
            style="display:block"
            data-ad-client="ca-pub-6022794906780783"
            data-ad-slot="6135885040"
            data-ad-format="auto"
            data-full-width-responsive="true"></ins>
        </div>

      </section>

      <!-- ê²°ê³¼ ì¹´ë“œ -->
      <section class="card result-wrap" id="resultWrap" aria-labelledby="resultTitle">
        <h2 id="resultTitle">ê²°ê³¼</h2>
        <div class="result">
          <div class="muted" id="nowKst">í˜„ì¬ ì‹œê°: -</div>

          <div class="headline">
            <span id="ageMain" class="copyable">ë§Œ - ì„¸</span>
            <button class="btn small" id="copyAge">ë³µì‚¬</button>
          </div>

          <div class="kpi-line">
            <span class="muted">ë‹¤ìŒ ìƒì¼ê¹Œì§€</span>
            <div style="display:flex;align-items:center;gap:10px;">
              <b id="dday">-ì¼</b>
              <button class="btn small" data-copy="dday">ë³µì‚¬</button>
            </div>
          </div>

          <div class="kpi-line">
            <span class="muted">ì‚´ì•„ì˜¨ ë‚ </span>
            <div style="display:flex;align-items:center;gap:10px;">
              <b id="lived">-ì¼</b>
              <button class="btn small" data-copy="lived">ë³µì‚¬</button>
            </div>
          </div>

          <div class="kpi-line">
            <span class="muted">ì´ ê°œì›”</span>
            <div style="display:flex;align-items:center;gap:10px;">
              <b id="ageMonths">-ê°œì›”</b>
              <button class="btn small" data-copy="ageMonths">ë³µì‚¬</button>
            </div>
          </div>

          <div class="kpi-line">
            <span class="muted">ì„¸/ê°œì›”</span>
            <div style="display:flex;align-items:center;gap:10px;">
              <b id="ageYearMonth">-ì„¸ -ê°œì›”</b>
              <button class="btn small" data-copy="ageYearMonth">ë³µì‚¬</button>
            </div>
          </div>

          <div class="kpi-line">
            <span class="muted">ì„¸ë¯¸ì½œë¡ </span>
            <div style="display:flex;align-items:center;gap:10px;">
              <b id="ageSemicolon">-;-</b>
              <button class="btn small" data-copy="ageSemicolon">ë³µì‚¬</button>
            </div>
          </div>

          <div class="muted" style="font-size:12px">â€» ì°¸ê³ ìš© ì •ë³´ì…ë‹ˆë‹¤. ë²•ì Â·ì˜í•™ì  íŒë‹¨ì´ í•„ìš”í•œ ê²½ìš° ê³µì‹ ë¬¸ì„œë¥¼ í™•ì¸í•˜ì„¸ìš”.</div>

          <div id="adMid"></div>
        </div>
      </section>
    </main>

    <footer><p>Â© <span id="year"></span> Tool Box </p></footer>
  </div>

  <script>
    // ===== KST ìœ í‹¸ =====
    const KST='Asia/Seoul';
    const fmtNow=new Intl.DateTimeFormat('ko-KR',{timeZone:KST,year:'numeric',month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'});
    const fmtYMD=new Intl.DateTimeFormat('en-CA',{timeZone:KST,year:'numeric',month:'2-digit',day:'2-digit'});
    function zonedYMD(d){ const [y,m,dd]=fmtYMD.format(new Date(d)).split('-').map(Number); return {y, m, d: dd}; }

    // ===== ì…ë ¥ í¬ë§· =====
    const dobInput=document.getElementById('dob');
    function formatYMD(v){ v=(v||'').replace(/\D/g,'').slice(0,8); if(v.length>4)v=v.slice(0,4)+'-'+v.slice(4); if(v.length>7)v=v.slice(0,7)+'-'+v.slice(7,9); return v; }
    dobInput.addEventListener('input',(e)=>{ e.target.value=formatYMD(e.target.value); syncCalendarFromInput(); });
    dobInput.addEventListener('blur',(e)=>{ e.target.value=formatYMD(e.target.value); });

// ===== ë‹¬ë ¥ ìœ„ì ¯ =====
const picker=document.getElementById('picker');
    function getInputYMDOrToday(){ 
      const v=dobInput.value; 
      if(/^\d{4}-\d{2}-\d{2}$/.test(v)){
        const [y,m,d]=v.split('-').map(Number); 
        return {y,m,d};
      } 
      return zonedYMD(new Date()); 
    }

    // ë‹¬ë ¥ ì—´ê¸°/ë‹«ê¸° í•¨ìˆ˜ë“¤
    function openPicker(){
      const {y,m} = getInputYMDOrToday(); 
      buildCalendar(y, m-1);
      const box = document.querySelector('.datebox'); 
      const rect = box.getBoundingClientRect();
      const spaceBelow = window.innerHeight - rect.bottom; 
      const spaceAbove = rect.top;
      picker.classList.toggle('above', spaceBelow < 320 && spaceAbove > spaceBelow);
      picker.style.display = 'block';
    }

    function closePicker(){ 
      picker.style.display = 'none'; 
    }

    function syncCalendarFromInput(){ 
      if(picker.style.display === 'block'){ 
        const {y,m} = getInputYMDOrToday(); 
        buildCalendar(y, m-1); 
      } 
    }

    function buildCalendar(y, m0){
      picker.innerHTML='';
      const header=document.createElement('div'); header.className='cal-header';

      const yearSelect=document.createElement('select');
      for(let yy=y-50; yy<=y+50; yy++){
        const o=document.createElement('option');
        o.value=yy; o.textContent=yy; if(yy===y)o.selected=true;
        yearSelect.appendChild(o);
      }

      const monthSelect=document.createElement('select');
      for(let mm=0; mm<12; mm++){
        const o=document.createElement('option');
        o.value=mm; o.textContent=mm+1; if(mm===m0)o.selected=true;
        monthSelect.appendChild(o);
      }

      const left=document.createElement('div'); left.style.display='flex'; left.style.gap='6px';
      left.appendChild(yearSelect); left.appendChild(monthSelect);

      const mid=document.createElement('div'); mid.style.display='flex'; mid.style.alignItems='center';
      mid.style.gap='8px'; mid.style.justifyContent='center'; mid.style.flex='1';
      const title=document.createElement('div'); title.className='cal-title';
      title.textContent=`${y}ë…„ ${String(m0+1).padStart(2,'0')}ì›”`;
      const prevBtn=document.createElement('button'); prevBtn.type='button'; prevBtn.className='navbtn'; prevBtn.textContent='â—€';
      const nextBtn=document.createElement('button'); nextBtn.type='button'; nextBtn.className='navbtn'; nextBtn.textContent='â–¶';
      mid.appendChild(prevBtn); mid.appendChild(title); mid.appendChild(nextBtn);

      header.appendChild(left); header.appendChild(mid);
      picker.appendChild(header);

      const table=document.createElement('table');
      const thead=document.createElement('thead'); const tr=document.createElement('tr');
      ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '].forEach(d=>{
        const th=document.createElement('th'); th.textContent=d; tr.appendChild(th);
      });
      thead.appendChild(tr); table.appendChild(thead);

      const tbody=document.createElement('tbody'); let row=document.createElement('tr');
      const first = new Date(y, m0, 1).getDay();
      const last  = new Date(y, m0+1, 0).getDate();
      const prevLast = new Date(y, m0, 0).getDate();
      let col = 0;

      // ë‚ ì§œ ì„ íƒ í•¨ìˆ˜
      function selectDate(offset, day){
        let yy = y, mm = m0 + offset;
        if(mm < 0){ mm = 11; yy--; }
        if(mm > 11){ mm = 0; yy++; }
        const mmStr = String(mm+1).padStart(2,'0');
        const ddStr = String(day).padStart(2,'0');
        
        dobInput.value = `${yy}-${mmStr}-${ddStr}`;
        dobInput.dispatchEvent(new Event('input', { bubbles: true }));
        
        setTimeout(() => {
          closePicker();
        }, 50);
      }

      function addCell(text, offset, day){
        const td = document.createElement('td');
        td.textContent = text;
        if(offset !== 0) td.classList.add('other-month');
        
        td.addEventListener('click', (ev) => {
          ev.preventDefault();
          ev.stopPropagation();
          selectDate(offset, day);
        }, { passive: false });
        
        row.appendChild(td); 
        col++;
        if(col === 7){ 
          tbody.appendChild(row); 
          row = document.createElement('tr'); 
          col = 0; 
        }
      }

      // ë‹¬ë ¥ ë‚ ì§œ ì±„ìš°ê¸°
      for(let i=first-1; i>=0; i--){
        const d = prevLast - i;
        addCell(d, -1, d);
      }
      for(let d=1; d<=last; d++){
        addCell(d, 0, d);
      }
      const tail = (7 - col) % 7;
      for(let d=1; d<=tail; d++){
        addCell(d, +1, d);
      }

      table.appendChild(tbody); picker.appendChild(table);

      // ë…„/ì›” ì„ íƒ ì´ë²¤íŠ¸
      const rerender = () => buildCalendar(parseInt(yearSelect.value,10), parseInt(monthSelect.value,10));
      yearSelect.addEventListener('change', rerender);
      monthSelect.addEventListener('change', rerender);
      
      prevBtn.addEventListener('click', (e) => { 
        e.preventDefault(); 
        e.stopPropagation();
        let yy = parseInt(yearSelect.value,10), mm = parseInt(monthSelect.value,10);
        mm--; 
        if(mm < 0){ mm = 11; yy--; } 
        yearSelect.value = yy; 
        monthSelect.value = mm; 
        buildCalendar(yy, mm);
      });
      
      nextBtn.addEventListener('click', (e) => { 
        e.preventDefault(); 
        e.stopPropagation();
        let yy = parseInt(yearSelect.value,10), mm = parseInt(monthSelect.value,10);
        mm++; 
        if(mm > 11){ mm = 0; yy++; } 
        yearSelect.value = yy; 
        monthSelect.value = mm; 
        buildCalendar(yy, mm);
      });

      // ë‹¬ë ¥ ë‚´ë¶€ í´ë¦­ ì „íŒŒ ì°¨ë‹¨
      picker.addEventListener('click', (e) => {
        e.stopPropagation();
      }, { passive: true });
    }

    // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤
    document.getElementById('openCal').addEventListener('click', (e) => { 
      e.stopPropagation(); 
      if(picker.style.display === 'block') {
        closePicker();
      } else {
        openPicker();
      }
    });

    document.addEventListener('click', (e) => {
      const box = document.querySelector('.datebox');
      const pickerEl = document.getElementById('picker');
      
      if (pickerEl.style.display !== 'block') return;
      if (pickerEl && pickerEl.contains(e.target)) return;
      if (!box.contains(e.target)) {
        closePicker();
      }
    });
    // ===== ë§Œë‚˜ì´ ê³„ì‚° =====
    function calcAge(dobStr){
      if(!/^\d{4}-\d{2}-\d{2}$/.test(dobStr)) return null;

      const [by,bm,bd]=dobStr.split('-').map(Number);
      const {y:cy,m:cm,d:cd}=zonedYMD(new Date());

      const birthUTC = new Date(Date.UTC(by,bm-1,bd));
      const todayUTC = new Date(Date.UTC(cy,cm-1,cd));

      if (todayUTC < birthUTC){
        const daysToBirth = Math.ceil((birthUTC - todayUTC)/86400000);
        return { years:0, months:0, yPart:0, mPart:0, daysToNext:daysToBirth, daysLived:0 };
      }

      let years = cy - by;
      if (cm < bm || (cm === bm && cd < bd)) years -= 1;
      if (years < 0) years = 0;

      let months = (cy - by) * 12 + (cm - bm);
      if (cd < bd) months -= 1;
      if (months < 0) months = 0;

      const yPart = Math.floor(months / 12);
      const mPart = months % 12;

      let nextY = cy;
      if (cm > bm || (cm === bm && cd >= bd)) nextY = cy + 1;
      const nextBirthdayUTC = new Date(Date.UTC(nextY, bm-1, bd));
      const daysToNext = Math.ceil((nextBirthdayUTC - todayUTC)/86400000);

      const daysLived = Math.max(0, Math.floor((todayUTC - birthUTC)/86400000));

      return { years, months, yPart, mPart, daysToNext, daysLived };
    }

    function render(){
      const dob=dobInput.value.trim();
      if(!/^\d{4}-\d{2}-\d{2}$/.test(dob)){ alert('ìƒë…„ì›”ì¼ì„ YYYY-MM-DD í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•˜ì„¸ìš”.'); return; }
      const r=calcAge(dob); if(!r) return;
      const {years,months,yPart,mPart,daysToNext,daysLived}=r;

      document.getElementById('ageMain').textContent=`ë§Œ ${years}ì„¸`;
      document.getElementById('dday').textContent=`${daysToNext}ì¼`;
      document.getElementById('lived').textContent=`${daysLived.toLocaleString('ko-KR')}ì¼`;
      document.getElementById('ageMonths').textContent=`${months}ê°œì›”`;
      document.getElementById('ageYearMonth').textContent=`${yPart}ì„¸ ${mPart}ê°œì›”`;
      document.getElementById('ageSemicolon').textContent=`${yPart};${mPart}`;

      document.getElementById('resultWrap').style.display='block';
      document.getElementById('nowKst').textContent = `í˜„ì¬ ì‹œê°: ${fmtNow.format(new Date())} (KST)`;
    }

    function copyById(id){
      const txt=document.getElementById(id).textContent.trim();
      navigator.clipboard.writeText(txt).then(()=>{
        const btn = id==='ageMain'?document.getElementById('copyAge'):document.querySelector(`[data-copy="${id}"]`);
        if(btn){ const o=btn.textContent; btn.textContent='âœ…'; setTimeout(()=>btn.textContent=o,900); }
      });
    }

    // ì´ë²¤íŠ¸
    document.getElementById('calcBtn').addEventListener('click',render);
    document.getElementById('resetBtn').addEventListener('click',()=>{
      dobInput.value='';
      document.getElementById('resultWrap').style.display='none';
      closePicker();
    });
    document.getElementById('copyAge').addEventListener('click',()=>copyById('ageMain'));
    document.querySelectorAll('[data-copy]').forEach(b=>b.addEventListener('click',()=>copyById(b.dataset.copy)));

    document.getElementById('year').textContent=new Date().getFullYear();
  </script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // í˜ì´ì§€ ì•ˆì˜ ëª¨ë“  êµ¬ê¸€ ê´‘ê³  ìŠ¬ë¡¯ì„ ì°¾ìŠµë‹ˆë‹¤.
      const adSlots = document.querySelectorAll('ins.adsbygoogle');
      adSlots.forEach(slot => {
        // ê°ê°ì˜ ê´‘ê³  ìŠ¬ë¡¯ì— ëŒ€í•´ ì´ˆê¸°í™”ë¥¼ ìš”ì²­í•©ë‹ˆë‹¤.
        (adsbygoogle = window.adsbygoogle || []).push({});
      });
    });
  </script>
</body>
</html>