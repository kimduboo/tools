<!doctype html>
<html lang="ko" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>만나이(생활연령) 계산기 | Tool Box</title>
  <!-- 만나이 계산기 파비콘 (생일 케이크 🎂) -->
<link rel="icon" href="data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 100 100'%3E%3Crect width='100' height='100' rx='18' fill='%23ffffff'/%3E%3Ctext x='50' y='70' font-size='60' text-anchor='middle'%3E🎂%3C/text%3E%3C/svg%3E"/>

  <meta name="description" content="생년월일을 입력하면 KST 기준으로 만나이, 다음 생일까지 D-Day, 살아온 날, 개월수 표기를 제공합니다." />
  <script src="ads.js"></script>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="wrap">
    <header>
      <!-- 로고를 홈 링크로 -->
      <a class="brand" href="https://tools.joyful101.com/" aria-label="Tool Box 홈">
        <div class="logo" aria-hidden="true">
          <span class="logo-text">Tool<br>Box</span>
        </div>
      </a>
      <div class="title">
        <h1>만나이(생활연령) 계산기</h1>
        <p>결과 예: 만4세/49개월/4세1개월/4;1</p>
      </div>
      <div class="spacer" aria-hidden="true"></div>
    </header>

    <main class="age-main">
      <!-- 입력 카드 -->
      <section class="card" aria-labelledby="calcTitle">
        <h2 id="calcTitle">입력</h2>

        <div class="field">
          <label for="dob">생년월일</label>
          <div class="datebox">
            <input id="dob" type="text" placeholder="YYYY-MM-DD" maxlength="10" inputmode="numeric" autocomplete="off" aria-describedby="dobHelp" />
            <button type="button" class="calbtn" id="openCal" aria-label="달력 열기">📅</button>
            <div class="picker" id="picker" role="dialog" aria-modal="false" aria-label="달력 선택기"></div>
            <div id="dobHelp" class="muted" style="font-size:12px;margin-top:6px">예: 20251209 → 2025-12-09로 자동 포맷</div>
          </div>
        </div>

        <div class="actions">
          <button id="calcBtn" class="btn primary">계산하기</button>
          <button id="resetBtn" class="btn">초기화</button>
        </div>
        <p></p>

        <div class="ad-slot" id="adTop">
          <!-- 중간 수평 디스플레이 -->
          <ins class="adsbygoogle"
            style="display:block"
            data-ad-client="ca-pub-6022794906780783"
            data-ad-slot="6135885040"
            data-ad-format="auto"
            data-full-width-responsive="true"></ins>
        </div>

      </section>

      <!-- 결과 카드 -->
      <section class="card result-wrap" id="resultWrap" aria-labelledby="resultTitle">
        <h2 id="resultTitle">결과</h2>
        <div class="result">
          <div class="muted" id="nowKst">현재 시각: -</div>

          <div class="headline">
            <span id="ageMain" class="copyable">만 - 세</span>
            <button class="btn small" id="copyAge">복사</button>
          </div>

          <div class="kpi-line">
            <span class="muted">다음 생일까지</span>
            <div style="display:flex;align-items:center;gap:10px;">
              <b id="dday">-일</b>
              <button class="btn small" data-copy="dday">복사</button>
            </div>
          </div>

          <div class="kpi-line">
            <span class="muted">살아온 날</span>
            <div style="display:flex;align-items:center;gap:10px;">
              <b id="lived">-일</b>
              <button class="btn small" data-copy="lived">복사</button>
            </div>
          </div>

          <div class="kpi-line">
            <span class="muted">총 개월</span>
            <div style="display:flex;align-items:center;gap:10px;">
              <b id="ageMonths">-개월</b>
              <button class="btn small" data-copy="ageMonths">복사</button>
            </div>
          </div>

          <div class="kpi-line">
            <span class="muted">세/개월</span>
            <div style="display:flex;align-items:center;gap:10px;">
              <b id="ageYearMonth">-세 -개월</b>
              <button class="btn small" data-copy="ageYearMonth">복사</button>
            </div>
          </div>

          <div class="kpi-line">
            <span class="muted">세미콜론</span>
            <div style="display:flex;align-items:center;gap:10px;">
              <b id="ageSemicolon">-;-</b>
              <button class="btn small" data-copy="ageSemicolon">복사</button>
            </div>
          </div>

          <div class="muted" style="font-size:12px">※ 참고용 정보입니다. 법적·의학적 판단이 필요한 경우 공식 문서를 확인하세요.</div>

          <div id="adMid"></div>
        </div>
      </section>
    </main>

    <footer><p>© <span id="year"></span> Tool Box </p></footer>
  </div>

  <script>
    // ===== KST 유틸 =====
    const KST='Asia/Seoul';
    const fmtNow=new Intl.DateTimeFormat('ko-KR',{timeZone:KST,year:'numeric',month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'});
    const fmtYMD=new Intl.DateTimeFormat('en-CA',{timeZone:KST,year:'numeric',month:'2-digit',day:'2-digit'});
    function zonedYMD(d){ const [y,m,dd]=fmtYMD.format(new Date(d)).split('-').map(Number); return {y, m, d: dd}; }

    // ===== 입력 포맷 =====
    const dobInput=document.getElementById('dob');
    function formatYMD(v){ v=(v||'').replace(/\D/g,'').slice(0,8); if(v.length>4)v=v.slice(0,4)+'-'+v.slice(4); if(v.length>7)v=v.slice(0,7)+'-'+v.slice(7,9); return v; }
    dobInput.addEventListener('input',(e)=>{ e.target.value=formatYMD(e.target.value); syncCalendarFromInput(); });
    dobInput.addEventListener('blur',(e)=>{ e.target.value=formatYMD(e.target.value); });

// ===== 달력 위젯 =====
const picker=document.getElementById('picker');
    function getInputYMDOrToday(){ 
      const v=dobInput.value; 
      if(/^\d{4}-\d{2}-\d{2}$/.test(v)){
        const [y,m,d]=v.split('-').map(Number); 
        return {y,m,d};
      } 
      return zonedYMD(new Date()); 
    }

    // 달력 열기/닫기 함수들
    function openPicker(){
      const {y,m} = getInputYMDOrToday(); 
      buildCalendar(y, m-1);
      const box = document.querySelector('.datebox'); 
      const rect = box.getBoundingClientRect();
      const spaceBelow = window.innerHeight - rect.bottom; 
      const spaceAbove = rect.top;
      picker.classList.toggle('above', spaceBelow < 320 && spaceAbove > spaceBelow);
      picker.style.display = 'block';
    }

    function closePicker(){ 
      picker.style.display = 'none'; 
    }

    function syncCalendarFromInput(){ 
      if(picker.style.display === 'block'){ 
        const {y,m} = getInputYMDOrToday(); 
        buildCalendar(y, m-1); 
      } 
    }

    function buildCalendar(y, m0){
      picker.innerHTML='';
      const header=document.createElement('div'); header.className='cal-header';

      const yearSelect=document.createElement('select');
      for(let yy=y-50; yy<=y+50; yy++){
        const o=document.createElement('option');
        o.value=yy; o.textContent=yy; if(yy===y)o.selected=true;
        yearSelect.appendChild(o);
      }

      const monthSelect=document.createElement('select');
      for(let mm=0; mm<12; mm++){
        const o=document.createElement('option');
        o.value=mm; o.textContent=mm+1; if(mm===m0)o.selected=true;
        monthSelect.appendChild(o);
      }

      const left=document.createElement('div'); left.style.display='flex'; left.style.gap='6px';
      left.appendChild(yearSelect); left.appendChild(monthSelect);

      const mid=document.createElement('div'); mid.style.display='flex'; mid.style.alignItems='center';
      mid.style.gap='8px'; mid.style.justifyContent='center'; mid.style.flex='1';
      const title=document.createElement('div'); title.className='cal-title';
      title.textContent=`${y}년 ${String(m0+1).padStart(2,'0')}월`;
      const prevBtn=document.createElement('button'); prevBtn.type='button'; prevBtn.className='navbtn'; prevBtn.textContent='◀';
      const nextBtn=document.createElement('button'); nextBtn.type='button'; nextBtn.className='navbtn'; nextBtn.textContent='▶';
      mid.appendChild(prevBtn); mid.appendChild(title); mid.appendChild(nextBtn);

      header.appendChild(left); header.appendChild(mid);
      picker.appendChild(header);

      const table=document.createElement('table');
      const thead=document.createElement('thead'); const tr=document.createElement('tr');
      ['일','월','화','수','목','금','토'].forEach(d=>{
        const th=document.createElement('th'); th.textContent=d; tr.appendChild(th);
      });
      thead.appendChild(tr); table.appendChild(thead);

      const tbody=document.createElement('tbody'); let row=document.createElement('tr');
      const first = new Date(y, m0, 1).getDay();
      const last  = new Date(y, m0+1, 0).getDate();
      const prevLast = new Date(y, m0, 0).getDate();
      let col = 0;

      // 날짜 선택 함수
      function selectDate(offset, day){
        let yy = y, mm = m0 + offset;
        if(mm < 0){ mm = 11; yy--; }
        if(mm > 11){ mm = 0; yy++; }
        const mmStr = String(mm+1).padStart(2,'0');
        const ddStr = String(day).padStart(2,'0');
        
        dobInput.value = `${yy}-${mmStr}-${ddStr}`;
        dobInput.dispatchEvent(new Event('input', { bubbles: true }));
        
        setTimeout(() => {
          closePicker();
        }, 50);
      }

      function addCell(text, offset, day){
        const td = document.createElement('td');
        td.textContent = text;
        if(offset !== 0) td.classList.add('other-month');
        
        td.addEventListener('click', (ev) => {
          ev.preventDefault();
          ev.stopPropagation();
          selectDate(offset, day);
        }, { passive: false });
        
        row.appendChild(td); 
        col++;
        if(col === 7){ 
          tbody.appendChild(row); 
          row = document.createElement('tr'); 
          col = 0; 
        }
      }

      // 달력 날짜 채우기
      for(let i=first-1; i>=0; i--){
        const d = prevLast - i;
        addCell(d, -1, d);
      }
      for(let d=1; d<=last; d++){
        addCell(d, 0, d);
      }
      const tail = (7 - col) % 7;
      for(let d=1; d<=tail; d++){
        addCell(d, +1, d);
      }

      table.appendChild(tbody); picker.appendChild(table);

      // 년/월 선택 이벤트
      const rerender = () => buildCalendar(parseInt(yearSelect.value,10), parseInt(monthSelect.value,10));
      yearSelect.addEventListener('change', rerender);
      monthSelect.addEventListener('change', rerender);
      
      prevBtn.addEventListener('click', (e) => { 
        e.preventDefault(); 
        e.stopPropagation();
        let yy = parseInt(yearSelect.value,10), mm = parseInt(monthSelect.value,10);
        mm--; 
        if(mm < 0){ mm = 11; yy--; } 
        yearSelect.value = yy; 
        monthSelect.value = mm; 
        buildCalendar(yy, mm);
      });
      
      nextBtn.addEventListener('click', (e) => { 
        e.preventDefault(); 
        e.stopPropagation();
        let yy = parseInt(yearSelect.value,10), mm = parseInt(monthSelect.value,10);
        mm++; 
        if(mm > 11){ mm = 0; yy++; } 
        yearSelect.value = yy; 
        monthSelect.value = mm; 
        buildCalendar(yy, mm);
      });

      // 달력 내부 클릭 전파 차단
      picker.addEventListener('click', (e) => {
        e.stopPropagation();
      }, { passive: true });
    }

    // 이벤트 리스너들
    document.getElementById('openCal').addEventListener('click', (e) => { 
      e.stopPropagation(); 
      if(picker.style.display === 'block') {
        closePicker();
      } else {
        openPicker();
      }
    });

    document.addEventListener('click', (e) => {
      const box = document.querySelector('.datebox');
      const pickerEl = document.getElementById('picker');
      
      if (pickerEl.style.display !== 'block') return;
      if (pickerEl && pickerEl.contains(e.target)) return;
      if (!box.contains(e.target)) {
        closePicker();
      }
    });
    // ===== 만나이 계산 =====
    function calcAge(dobStr){
      if(!/^\d{4}-\d{2}-\d{2}$/.test(dobStr)) return null;

      const [by,bm,bd]=dobStr.split('-').map(Number);
      const {y:cy,m:cm,d:cd}=zonedYMD(new Date());

      const birthUTC = new Date(Date.UTC(by,bm-1,bd));
      const todayUTC = new Date(Date.UTC(cy,cm-1,cd));

      if (todayUTC < birthUTC){
        const daysToBirth = Math.ceil((birthUTC - todayUTC)/86400000);
        return { years:0, months:0, yPart:0, mPart:0, daysToNext:daysToBirth, daysLived:0 };
      }

      let years = cy - by;
      if (cm < bm || (cm === bm && cd < bd)) years -= 1;
      if (years < 0) years = 0;

      let months = (cy - by) * 12 + (cm - bm);
      if (cd < bd) months -= 1;
      if (months < 0) months = 0;

      const yPart = Math.floor(months / 12);
      const mPart = months % 12;

      let nextY = cy;
      if (cm > bm || (cm === bm && cd >= bd)) nextY = cy + 1;
      const nextBirthdayUTC = new Date(Date.UTC(nextY, bm-1, bd));
      const daysToNext = Math.ceil((nextBirthdayUTC - todayUTC)/86400000);

      const daysLived = Math.max(0, Math.floor((todayUTC - birthUTC)/86400000));

      return { years, months, yPart, mPart, daysToNext, daysLived };
    }

    function render(){
      const dob=dobInput.value.trim();
      if(!/^\d{4}-\d{2}-\d{2}$/.test(dob)){ alert('생년월일을 YYYY-MM-DD 형식으로 입력하세요.'); return; }
      const r=calcAge(dob); if(!r) return;
      const {years,months,yPart,mPart,daysToNext,daysLived}=r;

      document.getElementById('ageMain').textContent=`만 ${years}세`;
      document.getElementById('dday').textContent=`${daysToNext}일`;
      document.getElementById('lived').textContent=`${daysLived.toLocaleString('ko-KR')}일`;
      document.getElementById('ageMonths').textContent=`${months}개월`;
      document.getElementById('ageYearMonth').textContent=`${yPart}세 ${mPart}개월`;
      document.getElementById('ageSemicolon').textContent=`${yPart};${mPart}`;

      document.getElementById('resultWrap').style.display='block';
      document.getElementById('nowKst').textContent = `현재 시각: ${fmtNow.format(new Date())} (KST)`;
    }

    function copyById(id){
      const txt=document.getElementById(id).textContent.trim();
      navigator.clipboard.writeText(txt).then(()=>{
        const btn = id==='ageMain'?document.getElementById('copyAge'):document.querySelector(`[data-copy="${id}"]`);
        if(btn){ const o=btn.textContent; btn.textContent='✅'; setTimeout(()=>btn.textContent=o,900); }
      });
    }

    // 이벤트
    document.getElementById('calcBtn').addEventListener('click',render);
    document.getElementById('resetBtn').addEventListener('click',()=>{
      dobInput.value='';
      document.getElementById('resultWrap').style.display='none';
      closePicker();
    });
    document.getElementById('copyAge').addEventListener('click',()=>copyById('ageMain'));
    document.querySelectorAll('[data-copy]').forEach(b=>b.addEventListener('click',()=>copyById(b.dataset.copy)));

    document.getElementById('year').textContent=new Date().getFullYear();
  </script>
  <script>
    document.addEventListener("DOMContentLoaded", () => {
      // 페이지 안의 모든 구글 광고 슬롯을 찾습니다.
      const adSlots = document.querySelectorAll('ins.adsbygoogle');
      adSlots.forEach(slot => {
        // 각각의 광고 슬롯에 대해 초기화를 요청합니다.
        (adsbygoogle = window.adsbygoogle || []).push({});
      });
    });
  </script>
</body>
</html>