<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>만나이(생활연령) 계산기 | 툴서랍</title>
  <meta name="description" content="생년월일을 입력하면 KST 기준으로 만나이(생활연령)를 계산합니다. 다음 생일까지 D‑Day, 살아온 날, 개월수 표기(예: 49개월 / 4세 1개월 / 4;1) 제공." />

  <style>
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0; padding:20px; color:#1f2937;
      font-family:system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",sans-serif;
      background-color:#fafafa; position:relative;
    }
    /* 고정 그라데이션 배경(스크롤해도 끊김 없음) */
    body::before{
      content:""; position:fixed; inset:0; z-index:-1;
      background:
        radial-gradient(1200px 600px at 80% -10%, #dbeafe 0%, rgba(219,234,254,0) 60%),
        linear-gradient(#fafafa,#eaeaea);
      background-repeat:no-repeat,no-repeat;
      background-size:cover,cover;
      background-position:center,center;
    }

    .container{max-width:560px;margin:0 auto;background:#fff;padding:20px;border-radius:14px;box-shadow:0 6px 20px rgba(2,8,23,.08)}
    .home-btn{display:inline-block;margin-bottom:10px;color:#2563eb;text-decoration:none;font-weight:700}
    h1{margin:0;text-align:center;font-size:22px}
    .hint{margin:6px 0 14px;text-align:center;color:#6b7280;font-size:13px}
    label{display:block;margin-top:12px;font-weight:700}

    /* 입력 & 버튼 (D‑Day와 동일 계열) */
    input[type="text"]{width:100%;padding:12px;font-size:16px;border:2px solid #e5e7eb;border-radius:12px;margin-top:4px;background:#fff}
    input[type="text"]:focus{outline:none;border-color:#2563eb;box-shadow:0 0 0 4px rgba(37,99,235,.15)}
    .btn{display:inline-grid;place-items:center;padding:12px 14px;border-radius:12px;border:1px solid #e5e7eb;background:#fff;color:#1f2937;cursor:pointer;font-weight:700;font-size:14px}
    .btn:hover{filter:brightness(1.05)}
    .btn.small{padding:6px 8px;border-radius:10px;font-size:12px}
    .btn.primary{background:linear-gradient(135deg,#60a5fa,#2563eb);border-color:#2563eb;color:#fff}
    .actions{display:flex;gap:10px;margin-top:14px}

/*계산하기-초기화 버튼비율*/
.actions{
  display:flex;
  gap:10px;
  margin-top:14px;
  flex-wrap:wrap;            /* 폭이 좁아지면 자동 줄바꿈 */
}

/* 기본은 2:1 비율 유지 (grow:shrink:basis) */
.actions #calcBtn { flex: 2 1 0; min-width: 180px; }
.actions #resetBtn{ flex: 1 1 0; min-width: 120px; }

/* 아주 좁은 화면에서는 세로로 쌓고 각 버튼 100% 폭 */
@media (max-width: 420px){
  .actions #calcBtn,
  .actions #resetBtn{
    flex: 1 1 100%;
  }
}



    /* 달력 위젯 (D‑Day 동일) */
    .datebox{position:relative}
    .calbtn{position:absolute;right:6px;top:50%;transform:translateY(-50%);background:#fff;border:1px solid #e5e7eb;font-size:16px;cursor:pointer;border-radius:10px;padding:6px 10px}
    .picker{position:absolute;top:110%;left:0;right:0;background:#fff;border:1px solid #e5e7eb;border-radius:12px;padding:10px;box-shadow:0 10px 22px rgba(2,8,23,.1);z-index:10;display:none}
    .picker .cal-header{display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:6px}
    .picker .cal-title{flex:1;text-align:center;font-weight:800}
    .picker select{border:1px solid #e5e7eb;border-radius:8px;padding:6px 8px;background:#fff}
    .picker table{border-collapse:collapse;width:100%;font-size:14px}
    .picker th,.picker td{text-align:center;padding:8px;border-radius:8px;cursor:pointer}
    .picker th{color:#64748b;font-weight:700}
    .picker td:hover{background:#f1f5ff}

    /* 결과 영역: 처음엔 숨김 → 계산하기 후 노출 */
    .result-wrap{display:none;margin-top:16px}
    .headline{display:flex;gap:8px;align-items:center;justify-content:space-between;background:#eef2ff;border-radius:12px;padding:12px;font-size:20px;font-weight:800}
    .grid{display:grid;grid-template-columns:1fr 1fr;gap:10px;margin-top:12px}
    .kpi{display:flex;gap:8px;align-items:center;justify-content:space-between;border:1px dashed #e5e7eb;border-radius:12px;padding:12px;background:#fff}
    .note{margin-top:10px;color:#6b7280;font-size:12px}

    footer{margin:26px 0 0;text-align:center;color:#6b7280;font-size:14px}
    
  </style>
</head>
<body>
  <div class="container">
    <a href="/index.html" class="home-btn">← 툴서랍 홈</a>
    <h1>만나이(생활연령) 계산기</h1>
    <p class="hint">표기 예: <b>만 4세 / 49개월 / 4세 1개월 / 4;1</b></p>

    <!-- 입력 -->
    <label for="dob">생년월일</label>
    <div class="datebox">
      <input id="dob" type="text" placeholder="YYYY-MM-DD" maxlength="10" inputmode="numeric" autocomplete="off" aria-describedby="dobHelp" />
      <button type="button" class="calbtn btn small" id="openCal" aria-label="달력 열기">📅</button>
      <div id="picker" class="picker"></div>
      <div id="dobHelp" class="hint" style="margin:6px 0 0; text-align:left">예: 20251209 → 자동으로 2025-12-09로 포맷됩니다.</div>
    </div>

    <div class="actions">
        <button id="calcBtn" class="btn primary">계산하기</button>
        <button id="resetBtn" class="btn">초기화</button>
      </div>
      

    <!-- 결과 -->
    <section id="result" class="result-wrap" aria-live="polite">
      <div class="headline">
        <span id="ageMain">만 0세</span>
        <button class="btn small" id="copyAge">복사</button>
      </div>
      <div id="ageDetail" class="hint" style="text-align:left;margin:8px 0 0">-</div>

      <div class="grid">
        <div class="kpi"><span>다음 생일까지</span><b id="dday">-일</b><button class="btn small" data-copy="dday">복사</button></div>
        <div class="kpi"><span>살아온 날</span><b id="lived">-일</b><button class="btn small" data-copy="lived">복사</button></div>
      </div>

      <div class="kpi" style="margin-top:10px"><span>총 개월</span><b id="ageMonths">-개월</b><button class="btn small" data-copy="ageMonths">복사</button></div>
      <div class="kpi"><span>세/개월</span><b id="ageYearMonth">-세 -개월</b><button class="btn small" data-copy="ageYearMonth">복사</button></div>
      <div class="kpi"><span>세미콜론</span><b id="ageSemicolon">-;-</b><button class="btn small" data-copy="ageSemicolon">복사</button></div>

      <p class="note">※ 참고용 정보입니다. 법적·의학적 판단은 공식 문서를 확인하세요.</p>
    </section>
  </div>

  <footer><p>© <span id="year"></span> 툴서랍 </p></footer>

  <script>
    // ===== 고정: KST 기반 날짜 유틸 =====
    const KST = 'Asia/Seoul';
    const fmtNow = new Intl.DateTimeFormat('ko-KR',{timeZone:KST,year:'numeric',month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'});
    const fmtYMD = new Intl.DateTimeFormat('en-CA',{timeZone:KST,year:'numeric',month:'2-digit',day:'2-digit'});
    function zonedYMD(dateLike){const [y,m,d]=fmtYMD.format(new Date(dateLike)).split('-').map(Number);return {y,m,d};}

    // ===== 입력 포맷(연속 숫자 → YYYY-MM-DD) =====
    const dobInput=document.getElementById('dob');
    function formatYMD(v){v=(v||'').replace(/\D/g,'').slice(0,8); if(v.length>4)v=v.slice(0,4)+'-'+v.slice(4); if(v.length>7)v=v.slice(0,7)+'-'+v.slice(7,9); return v;}
    dobInput.addEventListener('input',e=>{e.target.value=formatYMD(e.target.value); syncCalendarFromInput();});
    dobInput.addEventListener('blur',e=>{e.target.value=formatYMD(e.target.value);});

    // ===== D‑Day 달력 위젯 그대로 이식 =====
    const picker=document.getElementById('picker');
    let calYear, calMonth; // 0~11
    function openPicker(){picker.style.display='block'; const {y,m}=getInputYMDOrToday(); calYear=y; calMonth=m-1; buildCalendar(calYear, calMonth);}
    function closePicker(){picker.style.display='none';}
    function getInputYMDOrToday(){const v=dobInput.value; if(/^\d{4}-\d{2}-\d{2}$/.test(v)){const [y,m,d]=v.split('-').map(Number); return {y,m,d};} return zonedYMD(new Date());}

    function buildCalendar(year,month){
      picker.innerHTML='';
      // 헤더
      const header=document.createElement('div'); header.className='cal-header';
      const yearSelect=document.createElement('select');
      for(let y=year-50;y<=year+50;y++){const o=document.createElement('option');o.value=y;o.textContent=y;if(y===year)o.selected=true;yearSelect.appendChild(o);}
      const monthSelect=document.createElement('select');
      for(let m=0;m<12;m++){const o=document.createElement('option');o.value=m;o.textContent=m+1;if(m===month)o.selected=true;monthSelect.appendChild(o);}
      const left=document.createElement('div'); left.appendChild(yearSelect); left.appendChild(monthSelect);
      const title=document.createElement('div'); title.className='cal-title'; title.id='calTitle'; title.textContent=`${year}년 ${String(month+1).padStart(2,'0')}월`;
      const right=document.createElement('div'); right.style.width='1px';
      header.appendChild(left); header.appendChild(title); header.appendChild(right);
      picker.appendChild(header);

      // 표
      const table=document.createElement('table');
      const days=['일','월','화','수','목','금','토'];
      const thead=document.createElement('thead'); const tr=document.createElement('tr');
      days.forEach(d=>{const th=document.createElement('th'); th.textContent=d; tr.appendChild(th);});
      thead.appendChild(tr); table.appendChild(thead);

      const firstDay=new Date(year,month,1).getDay();
      const lastDate=new Date(year,month+1,0).getDate();
      const tbody=document.createElement('tbody'); let row=document.createElement('tr');
      for(let i=0;i<firstDay;i++) row.appendChild(document.createElement('td'));
      for(let d=1; d<=lastDate; d++){
        const td=document.createElement('td'); td.textContent=d;
        td.addEventListener('click',()=>{
          const mm=String(month+1).padStart(2,'0'); const dd=String(d).padStart(2,'0');
          dobInput.value=`${year}-${mm}-${dd}`; closePicker();
        });
        row.appendChild(td);
        if((firstDay+d)%7===0){tbody.appendChild(row); row=document.createElement('tr');}
      }
      tbody.appendChild(row); table.appendChild(tbody); picker.appendChild(table);

      const rerender=()=>{buildCalendar(parseInt(yearSelect.value,10), parseInt(monthSelect.value,10));};
      yearSelect.addEventListener('change',rerender);
      monthSelect.addEventListener('change',rerender);
    }

    document.getElementById('openCal').addEventListener('click',()=>{
      (picker.style.display==='block')? closePicker() : openPicker();
    });
    document.addEventListener('click',(e)=>{const box=document.querySelector('.datebox'); if(!box.contains(e.target)) closePicker();});
    function syncCalendarFromInput(){ if(picker.style.display==='block'){ const {y,m}=getInputYMDOrToday(); buildCalendar(y, m-1); } }

    // ===== 만나이 계산 =====
    function calcAge(dobStr){
      if(!/^\d{4}-\d{2}-\d{2}$/.test(dobStr)) return null;
      const [by,bm,bd]=dobStr.split('-').map(Number);
      const {y:cy,m:cm,d:cd}=zonedYMD(new Date());

      let years=cy-by; if(cm<bm || (cm===bm && cd<bd)) years-=1;

      let months=(cy-by)*12 + (cm-bm); if(cd<bd) months-=1; if(months<0) months=0;
      const yPart=Math.floor(months/12), mPart=months%12;

      let nextY=cy; if(cm>bm || (cm===bm && cd>=bd)) nextY=cy+1;
      const nextBirthdayUTC=new Date(Date.UTC(nextY,bm-1,bd));
      const todayUTC=new Date(Date.UTC(cy,cm-1,cd));
      const daysToNext=Math.ceil((nextBirthdayUTC - todayUTC)/86400000);

      const birthUTC=new Date(Date.UTC(by,bm-1,bd));
      const daysLived=Math.floor((todayUTC - birthUTC)/86400000);

      return {years, months, yPart, mPart, daysToNext, daysLived};
    }

    // ===== 렌더/복사 =====
    function showResult(dob){
      const r=calcAge(dob); if(!r){alert('생년월일을 YYYY-MM-DD 형식으로 입력하세요.'); return;}
      const {years,months,yPart,mPart,daysToNext,daysLived}=r;
      document.getElementById('ageMain').textContent=`만 ${years}세`;
      document.getElementById('ageDetail').textContent=`${dob} 기준 · 현재 시각 ${fmtNow.format(new Date())} (KST)`;
      document.getElementById('dday').textContent = `${daysToNext}일`;
      document.getElementById('lived').textContent = `${daysLived.toLocaleString('ko-KR')}일`;
      document.getElementById('ageMonths').textContent = `${months}개월`;
      document.getElementById('ageYearMonth').textContent = `${yPart}세 ${mPart}개월`;
      document.getElementById('ageSemicolon').textContent = `${yPart};${mPart}`;
      document.getElementById('result').style.display='block';
    }

    function copyById(id){
      const txt=document.getElementById(id).textContent.trim();
      navigator.clipboard.writeText(txt).then(()=>{
        const btn = id==='ageMain' ? document.getElementById('copyAge') : document.querySelector(`[data-copy="${id}"]`);
        if(btn){ const old=btn.textContent; btn.textContent='✅'; setTimeout(()=>btn.textContent='복사',900); }
      });
    }

    // 버튼 이벤트
    document.getElementById('calcBtn').addEventListener('click',()=>{ showResult(dobInput.value); });
    document.getElementById('resetBtn').addEventListener('click',()=>{
      dobInput.value=''; document.getElementById('result').style.display='none'; picker.style.display='none';
    });
    document.getElementById('copyAge').addEventListener('click',()=>copyById('ageMain'));
    document.querySelectorAll('[data-copy]').forEach(b=>b.addEventListener('click',()=>copyById(b.dataset.copy)));

    // 초기
    document.getElementById('year').textContent=new Date().getFullYear();
  </script>
</body>
</html>
