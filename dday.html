<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>D-Day ê³„ì‚°ê¸° | íˆ´ì„œë</title>
  <style>
    *{box-sizing:border-box}
    html, body {height: 100%; margin:0; padding:0;}
    body {
      font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans KR", sans-serif;
      padding:20px;
      color:#1f2937;
      position: relative;
      background-color:#fafafa;
    }
    /* ìŠ¤í¬ë¡¤í•´ë„ ëŠê¸°ì§€ ì•ŠëŠ” ê³ ì • ê·¸ë¼ë°ì´ì…˜ */
    body::before {
      content: "";
      position: fixed;
      inset: 0;
      z-index: -1;
      background:
        radial-gradient(1200px 600px at 80% -10%, #dbeafe 0%, rgba(219,234,254,0) 60%),
        linear-gradient(#fafafa, #eaeaea);
      background-repeat: no-repeat, no-repeat;
      background-size: 1600px 800px, auto;
      background-position: right -200px top -180px, 0 0;
    }

    .container {max-width:560px; margin:0 auto; background:#fff; padding:20px; border-radius:14px; box-shadow:0 6px 20px rgba(2,8,23,.08); overflow:hidden}
    .home-btn {display:inline-block; margin-bottom:10px; color:#2563eb; text-decoration:none; font-weight:700}
    h1 {margin:0; text-align:center; font-size:22px}
    .hint {margin:6px 0 14px; text-align:center; color:#6b7280; font-size:13px}

    label {display:block; margin-top:12px; font-weight:700;}
    input[type="text"] {width:100%; padding:12px 52px 12px 12px; font-size:16px; border:2px solid #e5e7eb; border-radius:12px; margin-top:4px; background:#fff}
    input[type="text"]:focus{outline:none; border-color:#2563eb; box-shadow:0 0 0 4px rgba(37,99,235,.15)}
/*ê³„ì‚°í•˜ê¸°-ì´ˆê¸°í™” ë²„íŠ¼ë¹„ìœ¨*/
.actions{
  display:flex;
  gap:10px;
  margin-top:14px;
  flex-wrap:wrap;            /* í­ì´ ì¢ì•„ì§€ë©´ ìë™ ì¤„ë°”ê¿ˆ */
}

/* ê¸°ë³¸ì€ 2:1 ë¹„ìœ¨ ìœ ì§€ (grow:shrink:basis) */
.actions #calcBtn { flex: 2 1 0; min-width: 180px; }
.actions #resetBtn{ flex: 1 1 0; min-width: 120px; }

/* ì•„ì£¼ ì¢ì€ í™”ë©´ì—ì„œëŠ” ì„¸ë¡œë¡œ ìŒ“ê³  ê° ë²„íŠ¼ 100% í­ */
@media (max-width: 420px){
  .actions #calcBtn,
  .actions #resetBtn{
    flex: 1 1 100%;
  }
}
    /* ë²„íŠ¼ â€“ ë§Œë‚˜ì´ ê³„ì‚°ê¸°ì™€ ë™ì¼ ê³„ì—´ */
    .btn{display:inline-grid; place-items:center; padding:12px 14px; border-radius:12px; border:1px solid #e5e7eb; background:#fff; color:#1f2937; cursor:pointer; font-weight:700; font-size:14px}
    .btn:hover{filter:brightness(1.05)}
    .btn.small{padding:6px 8px; border-radius:10px; font-size:12px}
    .btn.primary{background:linear-gradient(135deg,#60a5fa,#2563eb); border-color:#2563eb; color:#fff}

    .date-picker-wrapper {position:relative;}
    .calendar-btn {position:absolute; right:6px; top:50%; transform:translateY(-50%); background:#fff; border:1px solid #e5e7eb; font-size:16px; cursor:pointer; border-radius:10px; padding:6px 10px}

    .calendar {position:absolute; top:110%; left:0; right:0; background:#fff; border:1px solid #e5e7eb; border-radius:12px; padding:10px; box-shadow:0 10px 22px rgba(2,8,23,.1); z-index:10; display:none}
    .calendar .cal-header{display:flex; align-items:center; justify-content:space-between; gap:8px; margin-bottom:6px}
    .calendar .cal-title{flex:1; text-align:center; font-weight:800}
    .calendar select {border:1px solid #e5e7eb; border-radius:8px; padding:6px 8px; background:#fff}
    .calendar table {border-collapse:collapse; width:100%; font-size:14px}
    .calendar th, .calendar td {text-align:center; padding:8px; cursor:pointer; border-radius:8px}
    .calendar th{color:#64748b; font-weight:700}
    .calendar td:hover {background:#f1f5ff;}

    .actions{display:flex; gap:10px; margin-top:14px}

    .result {margin-top:16px; padding:12px; background:#eef2ff; border-radius:12px; font-size:18px; display:none; justify-content:space-between; align-items:center;}

    .kpi {display:none; margin-top:12px}
    .kpi-grid {display:grid; grid-template-columns:1fr auto auto; gap:8px; align-items:center}
    .kpi-note {margin:10px 0 0; color:#6b7280; font-size:12px}

    footer {margin:28px 0 0; text-align:center; color:#6b7280; font-size:14px;}
  </style>
</head>
<body>
  <div class="container">
    <a href="/index.html" class="home-btn">â† íˆ´ì„œë í™ˆ</a>
    <h1>D-Day ê³„ì‚°ê¸°</h1>
    <p class="hint">ì£¼, ê°œì›”, ë‚¨ì€ í‰ì¼</p>

    <label for="labelInput">ì´ë²¤íŠ¸ëª… (ì„ íƒ)</label>
    <input id="labelInput" type="text" placeholder="ì˜ˆ: ìƒì¼" />
    
    <label for="dateInput">ëª©í‘œ ë‚ ì§œ</label>
    <div class="date-picker-wrapper">
      <input id="dateInput" type="text" placeholder="YYYY-MM-DD" maxlength="10" inputmode="numeric" autocomplete="off" aria-describedby="dateHelp" />
      <button type="button" class="calendar-btn btn small" id="calendarBtn" aria-label="ë‹¬ë ¥ ì—´ê¸°">ğŸ“…</button>
      <div class="calendar" id="calendar" role="dialog" aria-modal="false" aria-label="ë‹¬ë ¥ ì„ íƒê¸°"></div>
      <div id="dateHelp" class="hint" style="margin:6px 0 0; text-align:left">ì˜ˆ: 20251209 â†’ ìë™ìœ¼ë¡œ 2025-12-09ë¡œ í¬ë§·ë©ë‹ˆë‹¤.</div>
    </div>

    <div class="actions">
        <button id="calcBtn" class="btn primary">ê³„ì‚°í•˜ê¸°</button>
        <button id="resetBtn" class="btn">ì´ˆê¸°í™”</button>
      </div>
      
    
    <div id="resultBox" class="result">
      <span id="resultText"></span>
      <button class="btn small" id="copyBtn">ë³µì‚¬</button>
    </div>

    <!-- KPI ë¸”ë¡ -->
    <div id="kpiBox" class="kpi">
      <div class="kpi-grid">
        <div>ë‚¨ì€ ë‚ </div>       <b id="k_days">-</b>      <button class="btn small" data-copy="k_days">ë³µì‚¬</button>
        <div>ì£¼ (ê·¼ì‚¬)</div>     <b id="k_weeks">-</b>     <button class="btn small" data-copy="k_weeks">ë³µì‚¬</button>
        <div>ê°œì›” (ê·¼ì‚¬)</div>   <b id="k_months">-</b>    <button class="btn small" data-copy="k_months">ë³µì‚¬</button>
        <div>ë‚¨ì€ í‰ì¼</div>     <b id="k_biz">-</b>       <button class="btn small" data-copy="k_biz">ë³µì‚¬</button>
      </div>
      <p class="kpi-note">â€» <b>ë‚¨ì€ ë‚ </b>ì„ ì œì™¸í•œ <b>ì£¼/ê°œì›”/í‰ì¼</b> í•­ëª©ì€ ê·¼ì‚¬ì¹˜ì…ë‹ˆë‹¤.</p>
    </div>
  </div>

  <footer>
    <p>Â© <span id="year"></span> íˆ´ì„œë </p>
  </footer>

  <script>
    // ===== ì…ë ¥ í¬ë§·: 20251209 -> 2025-12-09
    const dateInput = document.getElementById('dateInput');
    dateInput.addEventListener('input', function(e) {
      let v = e.target.value.replace(/\D/g, '');
      if (v.length > 4) v = v.slice(0,4) + '-' + v.slice(4);
      if (v.length > 7) v = v.slice(0,7) + '-' + v.slice(7, 9);
      e.target.value = v;
      // ë‹¬ë ¥ì´ ì—´ë ¤ ìˆìœ¼ë©´ ì…ë ¥ ê¸°ì¤€ìœ¼ë¡œ ì¦‰ì‹œ ê°±ì‹ 
      syncCalendarFromInput();
    });

    // ===== ë‹¬ë ¥: ì—°/ì›” ë“œë¡­ë‹¤ìš´ + ì¤‘ì•™ íƒ€ì´í‹€
    function buildCalendar(year, month) {
      const calendar = document.getElementById('calendar');
      calendar.innerHTML = '';

      const header = document.createElement('div');
      header.className = 'cal-header';

      const yearSelect = document.createElement('select');
      for (let y = year - 50; y <= year + 50; y++) {
        const opt = document.createElement('option');
        opt.value = y; opt.textContent = y;
        if (y === year) opt.selected = true;
        yearSelect.appendChild(opt);
      }

      const monthSelect = document.createElement('select');
      for (let m = 0; m < 12; m++) {
        const opt = document.createElement('option');
        opt.value = m; opt.textContent = m + 1;
        if (m === month) opt.selected = true;
        monthSelect.appendChild(opt);
      }

      const left = document.createElement('div');
      left.appendChild(yearSelect);
      left.appendChild(monthSelect);

      const title = document.createElement('div');
      title.className = 'cal-title';
      title.id = 'calTitle';
      title.textContent = `${year}ë…„ ${String(month+1).padStart(2,'0')}ì›”`;

      const right = document.createElement('div'); right.style.width = '1px';

      header.appendChild(left); header.appendChild(title); header.appendChild(right);
      calendar.appendChild(header);

      const table = document.createElement('table');
      const days = ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '];
      const thead = document.createElement('thead');
      const tr = document.createElement('tr');
      days.forEach(d=>{ const th = document.createElement('th'); th.textContent = d; tr.appendChild(th); });
      thead.appendChild(tr); table.appendChild(thead);

      const firstDay = new Date(year, month, 1).getDay();
      const lastDate = new Date(year, month+1, 0).getDate();

      const tbody = document.createElement('tbody');
      let row = document.createElement('tr');
      for (let i = 0; i < firstDay; i++) row.appendChild(document.createElement('td'));

      for (let d = 1; d <= lastDate; d++) {
        const td = document.createElement('td');
        td.textContent = d;
        td.addEventListener('click', () => {
          const mm = String(month+1).padStart(2,'0');
          const dd = String(d).padStart(2,'0');
          dateInput.value = `${year}-${mm}-${dd}`;
          calendar.style.display = 'none';
        });
        row.appendChild(td);
        if ((firstDay + d) % 7 === 0) { tbody.appendChild(row); row = document.createElement('tr'); }
      }
      tbody.appendChild(row); table.appendChild(tbody); calendar.appendChild(table);

      const update = () => {
        const y = parseInt(yearSelect.value,10);
        const m = parseInt(monthSelect.value,10);
        buildCalendar(y, m);
      };
      yearSelect.addEventListener('change', update);
      monthSelect.addEventListener('change', update);
    }

    // ë‹¬ë ¥ ì—´ê¸°/ë‹«ê¸° ë° ì™¸ë¶€ í´ë¦­ ë‹«ê¸°
    const calendarBtn = document.getElementById('calendarBtn');
    calendarBtn.addEventListener('click', () => {
      const cal = document.getElementById('calendar');
      if (cal.style.display === 'none' || cal.style.display === '') {
        const base = getInputOrToday();
        buildCalendar(base.y, base.m);
        cal.style.display = 'block';
      } else { cal.style.display = 'none'; }
    });
    document.addEventListener('click', (e) => {
      const wrap = document.querySelector('.date-picker-wrapper');
      if (!wrap.contains(e.target)) document.getElementById('calendar').style.display = 'none';
    });

    function getInputOrToday(){
      const v = dateInput.value;
      if(/^\d{4}-\d{2}-\d{2}$/.test(v)) { const [y,m,d]=v.split('-').map(Number); return {y, m:m-1, d}; }
      const t = new Date(); return {y:t.getFullYear(), m:t.getMonth(), d:t.getDate()};
    }
    function syncCalendarFromInput(){
      const cal = document.getElementById('calendar');
      if(cal.style.display==='block'){
        const base = getInputOrToday();
        buildCalendar(base.y, base.m);
      }
    }

    // ===== KPI ê³„ì‚° ë³´ì¡° =====
    function countBusinessDays(startDate, endDate){
      let count = 0; const one = 86400000;
      let t = new Date(startDate.getTime() + one); // ë‹¤ìŒ ë‚ ë¶€í„° ì¹´ìš´íŠ¸
      while(t <= endDate){ const d = t.getDay(); if(d!==0 && d!==6) count++; t = new Date(t.getTime()+one); }
      return count;
    }
    function setKpis(absDays, bizDays){
      document.getElementById('k_days').textContent = `${absDays}ì¼`;
      document.getElementById('k_weeks').textContent = `${(absDays/7).toFixed(1)}ì£¼`;
      document.getElementById('k_months').textContent = `${(absDays/30).toFixed(1)}ê°œì›”`;
      document.getElementById('k_biz').textContent = `${bizDays}ì¼`;
      document.getElementById('kpiBox').style.display = 'block';
    }
    function bindKpiCopyButtons(){
      document.querySelectorAll('[data-copy]').forEach(btn=>{
        btn.onclick = ()=>{
          const id = btn.getAttribute('data-copy');
          const txt = document.getElementById(id).textContent.trim();
          navigator.clipboard.writeText(txt).then(()=>{ const old=btn.textContent; btn.textContent='âœ…'; setTimeout(()=>btn.textContent=old,900); });
        };
      });
    }

    // ===== ê³„ì‚° ë²„íŠ¼: D-0(D-day) í‘œê¸° + KPI ìƒì„± =====
    document.getElementById('calcBtn').addEventListener('click', function(){
      const label = document.getElementById('labelInput').value.trim();
      const dateStr = dateInput.value;
      if(!/^\d{4}-\d{2}-\d{2}$/.test(dateStr)) { alert('ë‚ ì§œë¥¼ YYYY-MM-DD í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•˜ì„¸ìš”.'); return; }
      const target = new Date(dateStr);
      const today = new Date(); today.setHours(0,0,0,0);
      const diff = Math.floor((target - today)/86400000); // ë‚´ì¼=1, ì˜¤ëŠ˜=0, ì–´ì œ=-1

      const head = diff===0 ? 'D-0 (D-day)' : (diff>0 ? `D-${diff}ì¼` : `D+${Math.abs(diff)}ì¼`);
      const text = label ? `${label}: ${head}` : head;
      document.getElementById('resultText').textContent = text;
      document.getElementById('resultBox').style.display = 'flex';

      const abs = Math.abs(diff);
      const biz = countBusinessDays(today, target);
      setKpis(abs, biz);
      bindKpiCopyButtons();
    });

    // ê²°ê³¼ ë³µì‚¬ (í—¤ë“œë¼ì¸)
    document.getElementById('copyBtn').addEventListener('click', function(){
      const text = document.getElementById('resultText').textContent;
      navigator.clipboard.writeText(text).then(()=>{ const b=this; const old=b.textContent; b.textContent='âœ…'; setTimeout(()=>b.textContent=old,900); });
    });

    // ì´ˆê¸°í™” ë²„íŠ¼
    document.getElementById('resetBtn').addEventListener('click', function(){
      document.getElementById('labelInput').value='';
      dateInput.value='';
      document.getElementById('resultBox').style.display='none';
      document.getElementById('kpiBox').style.display='none';
      document.getElementById('calendar').style.display='none';
    });

    // í‘¸í„° ì—°ë„
    document.getElementById('year').textContent = new Date().getFullYear();
  </script>
</body>
</html>
