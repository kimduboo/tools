<!doctype html>
<html lang="ko" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>D-Day 계산기 | 툴서랍</title>
  <meta name="description" content="목표 날짜를 입력하면 KST 기준으로 D-Day(D-0/D-/D+), 남은 날·주·개월(근사)·평일 수를 제공합니다." />
  <!-- (선택) AdSense 전역 스니펫 -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-6022794906780783" crossorigin="anonymous"></script>

<style>
    :root{
      --bg:#f7f9fd; --panel:#ffffff; --line:#e6eaf2; --ink:#1f2a37; --muted:#6b7280; --acc:#2563eb;
      --shadow:0 10px 22px rgba(2,8,23,.08);
    }
    *{box-sizing:border-box}
    html,body{height:100%}
    body{
      margin:0;color:var(--ink);font:16px/1.6 system-ui,-apple-system,Segoe UI,Roboto,"Noto Sans KR",Apple SD Gothic Neo,sans-serif;
      position:relative;background-color:#fafafa;
    }
    /* 고정 그라데이션 배경 */
    body::before{
      content:"";position:fixed;inset:0;z-index:-1;
      background:radial-gradient(1200px 600px at 80% -10%, #dbeafe 0%, transparent 60%), linear-gradient(#fafafa,#eaeaea);
      background-repeat:no-repeat,no-repeat;background-size:1600px 800px,auto;background-position:right -200px top -180px,0 0;
    }

    .wrap{max-width:960px;margin:0 auto;padding:24px;overflow:visible}
    header{display:flex;align-items:center;justify-content:space-between;gap:16px;padding:6px 0 18px}
    .brand{display:flex;align-items:center;gap:14px}
    .logo{width:44px;height:44px;display:grid;place-items:center;background:linear-gradient(135deg,#60a5fa,#2563eb);border-radius:14px;box-shadow:0 6px 18px rgba(37,99,235,.25);font-weight:900;color:#fff}
    .title h1{margin:0;font-size:clamp(20px,3vw,28px)}
    .title p{margin:4px 0 0;color:var(--muted);font-size:14px}
    .back{color:var(--acc);text-decoration:none}

    main{display:grid;grid-template-columns:1.2fr 0.8fr;gap:24px}
    @media (max-width:860px){main{grid-template-columns:1fr}}

    .card{background:var(--panel);border:1px solid var(--line);border-radius:20px;box-shadow:var(--shadow);padding:20px;overflow:visible}
    .card h2{margin:0 0 12px;font-size:18px}

    .field{display:flex;flex-direction:column;gap:10px;margin:12px 0}
    label{font-weight:700}

    /* 입력/달력 + 아이콘 정렬 */
    .datebox{position:relative}
    .datebox input{
      width:100%;background:#fff;color:var(--ink);border:2px solid var(--line);border-radius:14px;
      padding:16px 64px 16px 14px; /* 우측 아이콘 공간 */
      outline:none;font-size:18px;letter-spacing:.5px
    }
    .datebox input:focus{border-color:var(--acc);box-shadow:0 0 0 4px rgba(37,99,235,.15)}
    .calbtn{
      position:absolute;right:8px;top:50%;transform:translateY(-50%);
      width:40px;height:40px;display:grid;place-items:center;border-radius:10px;border:0;background:transparent;cursor:pointer;line-height:0;
      font-size:20px;
    }
    .calbtn:focus-visible{outline:2px solid rgba(37,99,235,.45);outline-offset:2px}
    .picker{
      position:absolute;left:0;right:0;top:calc(100% + 8px);
      background:#fff;border:1px solid var(--line);border-radius:14px;box-shadow:var(--shadow);padding:10px;display:none;
      z-index:9999;max-height:70vh;overflow:auto
    }
    .picker.above{top:auto;bottom:calc(100% + 8px)}
    .picker .cal-header{display:flex;align-items:center;justify-content:space-between;gap:8px;margin-bottom:6px}
    .picker .cal-title{font-weight:800}
    .picker select{border:1px solid var(--line);border-radius:8px;padding:6px 8px;background:#fff}
    .navbtn{border:1px solid var(--line);background:#fff;border-radius:8px;padding:6px 10px;cursor:pointer}

    /* 달력 표 레이아웃 동일 폭/높이 */
    .picker table{width:100%;table-layout:fixed;border-collapse:separate;border-spacing:0}
    .picker th,.picker td{width:14.285%;text-align:center}
    .picker th{color:#64748b;font-weight:700;padding:8px 0}
    .picker td{cursor:pointer;height:40px;line-height:40px;border-radius:8px}
    .picker td:hover{background:#eef2ff}
    .picker td.empty{visibility:hidden} /* 공백칸 자리 유지 */

    /* 버튼 2:1 */
    .btn{display:inline-grid;place-items:center;padding:12px 14px;border-radius:12px;border:1px solid var(--line);background:#fff;color:#000;cursor:pointer;font-weight:700;font-size:14px}
    .btn:hover{filter:brightness(1.05)}
    .btn.small{padding:6px 8px;border-radius:10px;font-size:12px}
    .btn.primary{background:linear-gradient(135deg,#60a5fa,#2563eb);border-color:#2563eb;color:#fff}
    .actions{display:flex;gap:10px;margin-top:14px;flex-wrap:wrap}
    .actions #calcBtn{flex:2 1 0;min-width:180px}
    .actions #resetBtn{flex:1 1 0;min-width:120px}
    @media (max-width:420px){.actions #calcBtn,.actions #resetBtn{flex:1 1 100%}}

    /* 결과 */
    .result-wrap{display:none}
    .result{display:grid;gap:12px}
    .flex{display:flex;align-items:center;gap:8px;flex-wrap:wrap}
    .flex.space{justify-content:space-between}
    .big{font-size:clamp(42px,8vw,72px);font-weight:900;letter-spacing:-1px}
    .muted{color:#6b7280}
    .grid{display:grid;grid-template-columns:repeat(2,1fr);gap:12px}
    .kpi{background:#fff;border:1px dashed var(--line);border-radius:16px;padding:14px}
    .kpi b{display:block;font-size:20px;margin-top:4px}

    footer{margin:24px 0 0;color:var(--muted);font-size:13px;text-align:center}
    .copyable{user-select:all}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
      <div class="brand">
        <div class="logo" aria-hidden="true">TS</div>
        <div class="title">
          <h1>D-Day 계산기</h1>
          <p>남은 날/주/개월(근사)· 평일</p>
        </div>
      </div>
      <!-- 홈 링크: 절대경로 -->
      <nav><a href="https://tools.joyful101.com/" class="back">🏠 툴서랍 홈</a></nav>
    </header>

    <main>
      <section class="card" aria-labelledby="calcTitle">
        <h2 id="calcTitle">입력</h2>

        <div class="field">
          <label for="label">이벤트 이름(선택)</label>
          <input id="label" type="text" placeholder="예: 시험일, 계약만료, 생일" />
        </div>

        <div class="field">
          <label for="date">목표 날짜</label>
          <div class="datebox">
            <input id="date" type="text" inputmode="numeric" autocomplete="off" placeholder="YYYY-MM-DD" maxlength="10" aria-describedby="dateHelp" />
            <button class="calbtn" id="openCal" type="button" aria-label="달력 열기">📅</button>
            <div class="picker" id="picker" role="dialog" aria-modal="false" aria-label="달력 선택기"></div>
            <div id="dateHelp" class="muted" style="font-size:12px;margin-top:6px">예: 20251209 → 2025-12-09로 자동 포맷</div>
          </div>
        </div>

        <div class="actions">
          <button id="calcBtn" class="btn primary" aria-label="D-Day 계산하기">계산하기</button>
          <button id="resetBtn" class="btn" aria-label="입력 초기화">초기화</button>
        </div>

        <div id="adTop"></div>
      </section>

      <section class="card result-wrap" id="resultWrap" aria-labelledby="resultTitle">
        <h2 id="resultTitle">결과</h2>
        <div class="result">
          <div class="muted" id="now">기준 시각: -</div>

          <div class="flex" style="margin-top:6px">
            <div class="big copyable" id="headline" aria-live="polite">D--</div>
            <button class="btn small" id="copyHeadline" aria-label="D-Day 복사">복사</button>
          </div>

          <!-- YYYY-MM-DD (이벤트명) 한 줄 + 복사 -->
          <div class="flex space">
            <div class="muted copyable" id="subline">-</div>
            <button class="btn small" id="copySubline">복사</button>
          </div>

          <div class="grid" style="margin-top:8px">
            <div class="kpi"><span class="muted">남은 날</span><b id="daysAbs">-일</b><div><button class="btn small" data-copy="daysAbs">복사</button></div></div>
            <div class="kpi"><span class="muted">주(근사)</span><b id="weeks">-주</b><div><button class="btn small" data-copy="weeks">복사</button></div></div>
            <div class="kpi"><span class="muted">개월(근사, 30일)</span><b id="months">-개월</b><div><button class="btn small" data-copy="months">복사</button></div></div>
            <div class="kpi"><span class="muted">평일 수(근사)</span><b id="bizdays">-일</b><div><button class="btn small" data-copy="bizdays">복사</button></div></div>
          </div>

          <div class="muted" style="font-size:12px;margin-top:8px">※ 주/개월/평일은 근사치입니다. (당일=0, 지났으면 음수)</div>

          <div id="adMid"></div>
        </div>
      </section>
    </main>

    <footer><p>© <span id="year"></span> 툴서랍 </p></footer>
  </div>

  <script>
    // ===== KST 유틸 =====
    const KST='Asia/Seoul';
    const fmtNow=new Intl.DateTimeFormat('ko-KR',{timeZone:KST,year:'numeric',month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'});
    const fmtYMD=new Intl.DateTimeFormat('en-CA',{timeZone:KST,year:'numeric',month:'2-digit',day:'2-digit'});
    function zonedYMD(d){ const [y,m,dd]=fmtYMD.format(new Date(d)).split('-').map(Number); return {y, m, d: dd}; }

    // ===== 입력 포맷 =====
    const dateInput=document.getElementById('date');
    function formatYMD(v){ v=(v||'').replace(/\D/g,'').slice(0,8); if(v.length>4)v=v.slice(0,4)+'-'+v.slice(4); if(v.length>7)v=v.slice(0,7)+'-'+v.slice(7,9); return v; }
    dateInput.addEventListener('input',(e)=>{ e.target.value=formatYMD(e.target.value); syncCalendarFromInput(); });
    dateInput.addEventListener('blur',(e)=>{ e.target.value=formatYMD(e.target.value); });

    // ===== 달력 위젯 =====
    const picker=document.getElementById('picker');
    function getInputYMDOrToday(){ const v=dateInput.value; if(/^\d{4}-\d{2}-\d{2}$/.test(v)){const [y,m,d]=v.split('-').map(Number); return {y,m,d};} return zonedYMD(new Date()); }

    function buildCalendar(y,m0){
      picker.innerHTML='';
      const header=document.createElement('div'); header.className='cal-header';

      const yearSelect=document.createElement('select');
      for(let yy=y-50; yy<=y+50; yy++){const o=document.createElement('option'); o.value=yy; o.textContent=yy; if(yy===y)o.selected=true; yearSelect.appendChild(o);}

      const monthSelect=document.createElement('select');
      for(let mm=0; mm<12; mm++){const o=document.createElement('option'); o.value=mm; o.textContent=mm+1; if(mm===m0)o.selected=true; monthSelect.appendChild(o);}

      const left=document.createElement('div'); left.style.display='flex'; left.style.gap='6px';
      left.appendChild(yearSelect); left.appendChild(monthSelect);

      const mid=document.createElement('div'); mid.style.display='flex'; mid.style.alignItems='center'; mid.style.gap='8px'; mid.style.justifyContent='center'; mid.style.flex='1';
      const title=document.createElement('div'); title.className='cal-title'; title.textContent=`${y}년 ${String(m0+1).padStart(2,'0')}월`;
      const prevBtn=document.createElement('button'); prevBtn.type='button'; prevBtn.className='navbtn'; prevBtn.textContent='◀';
      const nextBtn=document.createElement('button'); nextBtn.type='button'; nextBtn.className='navbtn'; nextBtn.textContent='▶';
      mid.appendChild(prevBtn); mid.appendChild(title); mid.appendChild(nextBtn);

      header.appendChild(left); header.appendChild(mid);
      picker.appendChild(header);

      const table=document.createElement('table');
      const thead=document.createElement('thead'); const tr=document.createElement('tr');
      ['일','월','화','수','목','금','토'].forEach(d=>{const th=document.createElement('th'); th.textContent=d; tr.appendChild(th);});
      thead.appendChild(tr); table.appendChild(thead);

      const first=new Date(y,m0,1).getDay();
      const last=new Date(y,m0+1,0).getDate();
      const tbody=document.createElement('tbody'); let row=document.createElement('tr');

      for(let i=0;i<first;i++){ const td=document.createElement('td'); td.className='empty'; row.appendChild(td); }

      for(let d=1; d<=last; d++){
        const td=document.createElement('td'); td.textContent=d;
        td.addEventListener('click',(ev)=>{ ev.stopPropagation(); const mm=String(m0+1).padStart(2,'0'); const dd=String(d).padStart(2,'0'); dateInput.value=`${y}-${mm}-${dd}`; closePicker(); });
        row.appendChild(td);
        if((first+d)%7===0){tbody.appendChild(row); row=document.createElement('tr');}
      }
      while(row.children.length && row.children.length<7){ const td=document.createElement('td'); td.className='empty'; row.appendChild(td); }
      tbody.appendChild(row); table.appendChild(tbody); picker.appendChild(table);

      const rerender=()=>buildCalendar(parseInt(yearSelect.value,10), parseInt(monthSelect.value,10));
      yearSelect.addEventListener('change',rerender); monthSelect.addEventListener('change',rerender);
      prevBtn.addEventListener('click',(e)=>{ e.preventDefault(); e.stopPropagation(); let yy=parseInt(yearSelect.value,10), mm=parseInt(monthSelect.value,10); mm--; if(mm<0){mm=11; yy--;} yearSelect.value=yy; monthSelect.value=mm; buildCalendar(yy,mm); });
      nextBtn.addEventListener('click',(e)=>{ e.preventDefault(); e.stopPropagation(); let yy=parseInt(yearSelect.value,10), mm=parseInt(monthSelect.value,10); mm++; if(mm>11){mm=0; yy++;} yearSelect.value=yy; monthSelect.value=mm; buildCalendar(yy,mm); });
      picker.addEventListener('pointerdown',(e)=>e.stopPropagation(), { once:true });
    }

    function openPicker(){
      const {y,m}=getInputYMDOrToday(); buildCalendar(y, m-1);
      const box=document.querySelector('.datebox'); const rect=box.getBoundingClientRect();
      const spaceBelow=window.innerHeight-rect.bottom; const spaceAbove=rect.top;
      picker.classList.toggle('above', spaceBelow<320 && spaceAbove>spaceBelow);
      picker.style.display='block';
    }
    function closePicker(){ picker.style.display='none'; }
    document.getElementById('openCal').addEventListener('click',(e)=>{ e.stopPropagation(); picker.style.display==='block'? closePicker(): openPicker(); });
    document.addEventListener('pointerdown',(e)=>{ const box=document.querySelector('.datebox'); if(!box.contains(e.target)) closePicker(); });
    function syncCalendarFromInput(){ if(picker.style.display==='block'){ const {y,m}=getInputYMDOrToday(); buildCalendar(y, m-1); } }

    // ===== 계산/표시 =====
    function fmtSigned(n,d=1){ const v=Number(n.toFixed(d)); return (Object.is(v,-0)?0:v).toFixed(d); }

    function diffDaysKST(targetStr){
      if(!/^\d{4}-\d{2}-\d{2}$/.test(targetStr)) return null;
      const {y:cy,m:cm,d:cd}=zonedYMD(new Date());
      const todayUTC=new Date(Date.UTC(cy,cm-1,cd));
      const [ty,tm,td]=targetStr.split('-').map(Number);
      const targetUTC=new Date(Date.UTC(ty,tm-1,td));
      const diff=Math.ceil((targetUTC - todayUTC)/86400000); // 미래 양수 / 오늘 0 / 과거 음수
      return { diff, todayUTC, targetUTC };
    }

    function countBizForward(startUTC,endUTC){
      let c=0,one=86400000,t=new Date(startUTC.getTime()+one);
      while(t<=endUTC){ const d=t.getUTCDay(); if(d!==0&&d!==6)c++; t=new Date(t.getTime()+one); }
      return c;
    }

    function render(){
      const date=dateInput.value.trim();
      const label=document.getElementById('label').value.trim();
      const r=diffDaysKST(date);
      if(!r){ alert('목표 날짜를 YYYY-MM-DD 형식으로 입력하세요.'); return; }
      const {diff,todayUTC,targetUTC}=r;

      // 헤드라인
      const head = diff===0 ? 'D-0 (D-day)' : (diff>0 ? `D-${diff}` : `D+${Math.abs(diff)}`);
      document.getElementById('headline').textContent=head;

      // YYYY-MM-DD (이벤트명) 한 줄
      const combined = label ? `${date} (${label})` : date;
      document.getElementById('subline').textContent = combined;

      // 수치(지났으면 음수, 당일 0, 미래 양수)
      const weeks = fmtSigned(diff/7)+'주';
      const months = fmtSigned(diff/30)+'개월';
      const biz   = diff>=0 ? countBizForward(todayUTC,targetUTC) : -countBizForward(targetUTC,todayUTC);

      document.getElementById('daysAbs').textContent = `${diff}일`;
      document.getElementById('weeks').textContent   = weeks;
      document.getElementById('months').textContent  = months;
      document.getElementById('bizdays').textContent = `${biz}일`;

      document.getElementById('now').textContent=`기준 시각: ${fmtNow.format(new Date())} (KST)`;
      document.getElementById('resultWrap').style.display='block';
    }

    function copyTextById(id){
      const txt=document.getElementById(id).textContent.trim();
      navigator.clipboard.writeText(txt).then(()=>{
        const map={
          headline:'copyHeadline',
          subline:'copySubline',
        };
        const btnId = map[id] || (document.querySelector(`[data-copy="${id}"]`)?.id);
        const btn = btnId ? document.getElementById(btnId) : document.querySelector(`[data-copy="${id}"]`);
        if(btn){ const o=btn.textContent; btn.textContent='✅'; setTimeout(()=>btn.textContent=o,900); }
      });
    }

    // 이벤트
    document.getElementById('calcBtn').addEventListener('click',render);
    document.getElementById('resetBtn').addEventListener('click',()=>{
      document.getElementById('label').value='';
      dateInput.value='';
      document.getElementById('resultWrap').style.display='none';
      closePicker();
    });
    document.getElementById('copyHeadline').addEventListener('click',()=>copyTextById('headline'));
    document.getElementById('copySubline').addEventListener('click',()=>copyTextById('subline'));
    document.querySelectorAll('[data-copy]').forEach(b=>b.addEventListener('click',()=>copyTextById(b.dataset.copy)));

    document.getElementById('year').textContent=new Date().getFullYear();
    document.getElementById('now').textContent=`기준 시각: ${fmtNow.format(new Date())} (KST)`;
  </script>
</body>
</html>
