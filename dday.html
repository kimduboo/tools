<!doctype html>
<html lang="ko" data-theme="light">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>D-Day ê³„ì‚°ê¸° | Tool Box</title>
  <meta name="description" content="ëª©í‘œ ë‚ ì§œë¥¼ ì…ë ¥í•˜ë©´ KST ê¸°ì¤€ìœ¼ë¡œ D-Day(D-0/D-/D+), ë‚¨ì€ ë‚ Â·ì£¼Â·ê°œì›”(ê·¼ì‚¬)Â·í‰ì¼ ìˆ˜ë¥¼ ì œê³µí•©ë‹ˆë‹¤." />
  <script src="ads.js"></script>
  <link rel="stylesheet" href="styles.css">
</head>
<body>
  <div class="wrap">
    <header>
      <!-- ë¡œê³ ë¥¼ í™ˆ ë§í¬ë¡œ -->
      <a class="brand" href="https://tools.joyful101.com/" aria-label="Tool Box í™ˆ">
        <div class="logo" aria-hidden="true">
          <span class="logo-text">Tool<br>Box</span>
        </div>
      </a>
      <!-- ì œëª©/ì„¤ëª… ì¤‘ì•™ ì •ë ¬ -->
      <div class="title">
        <h1>D-Day ê³„ì‚°ê¸°</h1>
        <p>ë‚¨ì€ ë‚ /ì£¼/ê°œì›”/í‰ì¼</p>
      </div>
      <!-- ì˜¤ë¥¸ìª½ì€ ë¹„ì›Œì„œ ê· í˜• -->
      <div class="spacer" aria-hidden="true"></div>
    </header>

    <main>
      <!-- ì…ë ¥: ê°€ìš´ë° 60% -->
      <section class="card center" aria-labelledby="calcTitle">
        <h2 id="calcTitle">ì…ë ¥</h2>

        <div class="field">
          <label for="label">ì´ë²¤íŠ¸ ì´ë¦„(ì„ íƒ)</label>
          <input id="label" type="text" placeholder="ì˜ˆ: ì‹œí—˜ì¼, ê³„ì•½ë§Œë£Œ, ìƒì¼" />
        </div>

        <div class="field">
          <label for="date">ëª©í‘œ ë‚ ì§œ</label>
          <div class="datebox">
            <input id="date" type="text" inputmode="numeric" autocomplete="off" placeholder="YYYY-MM-DD" maxlength="10" aria-describedby="dateHelp" />
            <button class="calbtn" id="openCal" type="button" aria-label="ë‹¬ë ¥ ì—´ê¸°">ğŸ“…</button>
            <div class="picker" id="picker" role="dialog" aria-modal="false" aria-label="ë‹¬ë ¥ ì„ íƒê¸°"></div>
            <div id="dateHelp" class="muted" style="font-size:12px;margin-top:6px">ì˜ˆ: 20251209 â†’ 2025-12-09ë¡œ ìë™ í¬ë§·</div>
          </div>
        </div>

        <div class="actions">
          <button id="calcBtn" class="btn primary" aria-label="D-Day ê³„ì‚°í•˜ê¸°">ê³„ì‚°í•˜ê¸°</button>
          <button id="resetBtn" class="btn" aria-label="ì…ë ¥ ì´ˆê¸°í™”">ì´ˆê¸°í™”</button>
        </div>
        <p></p>
        <center>
        <div class="ad-slot" id="adTop">
          <!-- ì¤‘ê°„ ìˆ˜í‰ ë””ìŠ¤í”Œë ˆì´ -->
          <ins class="adsbygoogle"
            style="display:block"
            data-ad-client="ca-pub-6022794906780783"
            data-ad-slot="6135885040"
            data-ad-format="auto"
            data-full-width-responsive="true"></ins>
          <script>
            (adsbygoogle = window.adsbygoogle || []).push({});
          </script>  
        </div>
        </center> 
      </section>

      <!-- ê²°ê³¼: ì•„ë˜ì— ë™ì¼ í­ìœ¼ë¡œ -->
      <section class="card center result-wrap" id="resultWrap" aria-labelledby="resultTitle">
        <h2 id="resultTitle">ê²°ê³¼</h2>
        <div class="result">
          <div class="muted" id="now">ê¸°ì¤€ ì‹œê°: -</div>

          <div class="flex" style="margin-top:6px">
            <div class="big copyable" id="headline" aria-live="polite">D--</div>
            <button class="btn small" id="copyHeadline" aria-label="D-Day ë³µì‚¬">ë³µì‚¬</button>
          </div>

          <div class="flex space">
            <div class="muted copyable" id="subline">-</div>
            <button class="btn small" id="copySubline">ë³µì‚¬</button>
          </div>

          <div class="grid kpi-grid" style="margin-top:8px">
            <div class="kpi">
                <span class="muted">ë‚¨ì€ ë‚ </span>
                <div class="kpi-content">
                  <b id="daysAbs">-ì¼</b>
                  <button class="btn small" data-copy="daysAbs">ë³µì‚¬</button>
                </div>
            </div>
            <div class="kpi">
                <span class="muted">ì£¼</span>
                <div class="kpi-content">
                    <b id="weeks">-ì£¼</b>
                    <button class="btn small" data-copy="weeks">ë³µì‚¬</button>
                </div>
            </div>
            <div class="kpi">
                <span class="muted">ê°œì›”(30ì¼)</span>
                <div class="kpi-content">
                    <b id="months">-ê°œì›”</b>
                    <button class="btn small" data-copy="months">ë³µì‚¬</button>
                </div>
            </div>
            <div class="kpi">
                <span class="muted">í‰ì¼ ìˆ˜</span>
                <div class="kpi-content">
                    <b id="bizdays">-ì¼</b>
                    <button class="btn small" data-copy="bizdays">ë³µì‚¬</button>
                </div>
            </div>
          </div>

          <div class="muted" style="font-size:12px;margin-top:8px">â€» ì£¼/ê°œì›”/í‰ì¼ì€ ê·¼ì‚¬ì¹˜ì…ë‹ˆë‹¤. (ë‹¹ì¼=0, ì§€ë‚¬ìœ¼ë©´ ìŒìˆ˜)</div>

          <div id="adMid"></div>
        </div>
      </section>
    </main>

    <footer><p>Â© <span id="year"></span> Tool Box </p></footer>
  </div>

  <script>
    const KST='Asia/Seoul';
    const fmtNow=new Intl.DateTimeFormat('ko-KR',{timeZone:KST,year:'numeric',month:'2-digit',day:'2-digit',hour:'2-digit',minute:'2-digit'});
    const fmtYMD=new Intl.DateTimeFormat('en-CA',{timeZone:KST,year:'numeric',month:'2-digit',day:'2-digit'});
    function zonedYMD(d){ const [y,m,dd]=fmtYMD.format(new Date(d)).split('-').map(Number); return {y, m, d: dd}; }

    const dateInput=document.getElementById('date');
    function formatYMD(v){ v=(v||'').replace(/\D/g,'').slice(0,8); if(v.length>4)v=v.slice(0,4)+'-'+v.slice(4); if(v.length>7)v=v.slice(0,7)+'-'+v.slice(7,9); return v; }
    dateInput.addEventListener('input',(e)=>{ e.target.value=formatYMD(e.target.value); syncCalendarFromInput(); });
    dateInput.addEventListener('blur',(e)=>{ e.target.value=formatYMD(e.target.value); });


    // ===== ë‹¬ë ¥ ìœ„ì ¯ ===== 
    const picker=document.getElementById('picker');
    function getInputYMDOrToday(){ const v=dateInput.value; if(/^\d{4}-\d{2}-\d{2}$/.test(v)){const [y,m,d]=v.split('-').map(Number); return {y,m,d};} return zonedYMD(new Date()); }

    function buildCalendar(y, m0){
  picker.innerHTML='';
  const header=document.createElement('div'); header.className='cal-header';

  const yearSelect=document.createElement('select');
  for(let yy=y-50; yy<=y+50; yy++){
    const o=document.createElement('option');
    o.value=yy; o.textContent=yy; if(yy===y)o.selected=true;
    yearSelect.appendChild(o);
  }

  const monthSelect=document.createElement('select');
  for(let mm=0; mm<12; mm++){
    const o=document.createElement('option');
    o.value=mm; o.textContent=mm+1; if(mm===m0)o.selected=true;
    monthSelect.appendChild(o);
  }

  const left=document.createElement('div'); left.style.display='flex'; left.style.gap='6px';
  left.appendChild(yearSelect); left.appendChild(monthSelect);

  const mid=document.createElement('div'); mid.style.display='flex'; mid.style.alignItems='center';
  mid.style.gap='8px'; mid.style.justifyContent='center'; mid.style.flex='1';
  const title=document.createElement('div'); title.className='cal-title';
  title.textContent=`${y}ë…„ ${String(m0+1).padStart(2,'0')}ì›”`;
  const prevBtn=document.createElement('button'); prevBtn.type='button'; prevBtn.className='navbtn'; prevBtn.textContent='â—€';
  const nextBtn=document.createElement('button'); nextBtn.type='button'; nextBtn.className='navbtn'; nextBtn.textContent='â–¶';
  mid.appendChild(prevBtn); mid.appendChild(title); mid.appendChild(nextBtn);

  header.appendChild(left); header.appendChild(mid);
  picker.appendChild(header);

  const table=document.createElement('table');
  const thead=document.createElement('thead'); const tr=document.createElement('tr');
  ['ì¼','ì›”','í™”','ìˆ˜','ëª©','ê¸ˆ','í† '].forEach(d=>{
    const th=document.createElement('th'); th.textContent=d; tr.appendChild(th);
  });
  thead.appendChild(tr); table.appendChild(thead);

  const tbody=document.createElement('tbody'); let row=document.createElement('tr');
  const first = new Date(y, m0, 1).getDay();       // ì´ë²ˆ ë‹¬ 1ì¼ì˜ ìš”ì¼
  const last  = new Date(y, m0+1, 0).getDate();    // ì´ë²ˆ ë‹¬ ë§ˆì§€ë§‰ ë‚ ì§œ
  const prevLast = new Date(y, m0, 0).getDate();   // ì§€ë‚œ ë‹¬ ë§ˆì§€ë§‰ ë‚ ì§œ
  let col = 0;

  function selectDate(offset, day){
    let yy=y, mm=m0 + offset;
    if(mm<0){ mm=11; yy--; }
    if(mm>11){ mm=0; yy++; }
    const mmStr=String(mm+1).padStart(2,'0');
    const ddStr=String(day).padStart(2,'0');
    dateInput.value=`${yy}-${mmStr}-${ddStr}`;
    closePicker();
  }
  function addCell(text, offset, day){
    const td=document.createElement('td');
    td.textContent=text;
    if(offset!==0) td.classList.add('other-month');
    td.addEventListener('pointerdown',(ev)=>{ ev.stopPropagation(); selectDate(offset, day); }, {passive:true});
    td.addEventListener('click',(ev)=>{
  ev.preventDefault();
  ev.stopPropagation();
  const mm = String(m0+1).padStart(2,'0');
  const dd = String(d).padStart(2,'0');
  dateInput.value = `${y}-${mm}-${dd}`;

  // ì…ë ¥ í¬ë§·/ì˜ì¡´ ë¡œì§ì´ ìˆë‹¤ë©´ íŠ¸ë¦¬ê±°
  dateInput.dispatchEvent(new Event('input', { bubbles:true }));

  // ë‹«ëŠ” ê±´ í•œ í‹± ë’¤ì— (ê°’ ì„¸íŒ…ì´ ì•ˆì •ì ìœ¼ë¡œ ë°˜ì˜ëœ ë’¤)
  setTimeout(()=>{
    closePicker();
    // í•„ìš”í•˜ë©´ í¬ì»¤ìŠ¤ ìœ ì§€
    dateInput.focus();
  }, 0);
});
    row.appendChild(td); col++;
    if(col===7){ tbody.appendChild(row); row=document.createElement('tr'); col=0; }
  }

  // 1) ì•ìª½ ë¹ˆì¹¸ â†’ ì§€ë‚œ ë‹¬ ë‚ ì§œë¡œ ì±„ìš°ê¸°
  for(let i=first-1; i>=0; i--){
    const d = prevLast - i;
    addCell(d, -1, d);
  }
  // 2) ì´ë²ˆ ë‹¬
  for(let d=1; d<=last; d++){
    addCell(d, 0, d);
  }
  // 3) ë’¤ìª½ ë¹ˆì¹¸ â†’ ë‹¤ìŒ ë‹¬ ë‚ ì§œë¡œ ì±„ìš°ê¸°
  const tail = (7 - col) % 7;
  for(let d=1; d<=tail; d++){
    addCell(d, +1, d);
  }

  table.appendChild(tbody); picker.appendChild(table);

  const rerender=()=>buildCalendar(parseInt(yearSelect.value,10), parseInt(monthSelect.value,10));
  yearSelect.addEventListener('change',rerender);
  monthSelect.addEventListener('change',rerender);
  prevBtn.addEventListener('click',(e)=>{ e.preventDefault(); e.stopPropagation();
    let yy=parseInt(yearSelect.value,10), mm=parseInt(monthSelect.value,10);
    mm--; if(mm<0){mm=11; yy--;} yearSelect.value=yy; monthSelect.value=mm; buildCalendar(yy,mm);
  });
  nextBtn.addEventListener('click',(e)=>{ e.preventDefault(); e.stopPropagation();
    let yy=parseInt(yearSelect.value,10), mm=parseInt(monthSelect.value,10);
    mm++; if(mm>11){mm=0; yy++;} yearSelect.value=yy; monthSelect.value=mm; buildCalendar(yy,mm);
  });

  // í”¼ì»¤ ë‚´ë¶€ëŠ” ë°”ê¹¥ í´ë¦­ ë‹«ê¸°ì™€ ì¶©ëŒ ë°©ì§€
  // ë‹¬ë ¥ ì•ˆì—ì„œ ë°œìƒí•˜ëŠ” í¬ì¸í„°/í„°ì¹˜/í´ë¦­ì€ ë°”ê¹¥ìœ¼ë¡œ ì•ˆë‚˜ê°€ê²Œ
['pointerdown','mousedown','touchstart','click'].forEach(evt=>{
  picker.addEventListener(evt, (e)=> e.stopPropagation(), { passive:true });
});

}


    function openPicker(){
      const {y,m}=getInputYMDOrToday(); buildCalendar(y, m-1);
      const box=document.querySelector('.datebox'); const rect=box.getBoundingClientRect();
      const spaceBelow=window.innerHeight-rect.bottom; const spaceAbove=rect.top;
      picker.classList.toggle('above', spaceBelow<320 && spaceAbove>spaceBelow);
      picker.style.display='block';
    }
    function closePicker(){ picker.style.display='none'; }
    document.getElementById('openCal').addEventListener('click',(e)=>{ e.stopPropagation(); picker.style.display==='block'? closePicker(): openPicker(); });
    document.addEventListener('pointerdown',(e)=>{
  const box = document.querySelector('.datebox');
  const pickerEl = document.getElementById('picker');
  // ë‹¬ë ¥ ë‚´ë¶€ í´ë¦­ì€ ë‹«ì§€ ì•ŠìŒ
  if (pickerEl && pickerEl.contains(e.target)) return;
  if (!box.contains(e.target)) closePicker();
});
    function syncCalendarFromInput(){ if(picker.style.display==='block'){ const {y,m}=getInputYMDOrToday(); buildCalendar(y, m-1); } }

    function fmtSigned(n,d=1){
      const v=Number(n.toFixed(d));
      return (Object.is(v,-0)?0:v).toFixed(d);
    }

    function diffDaysKST(targetStr){
      if(!/^\d{4}-\d{2}-\d{2}$/.test(targetStr)) return null;
      const {y:cy,m:cm,d:cd}=zonedYMD(new Date());
      const todayUTC=new Date(Date.UTC(cy,cm-1,cd));
      const [ty,tm,td]=targetStr.split('-').map(Number);
      const targetUTC=new Date(Date.UTC(ty,tm-1,td));
      const diff=Math.ceil((targetUTC - todayUTC)/86400000);
      return { diff, todayUTC, targetUTC };
    }

    function countBizForward(startUTC,endUTC){
      let c=0,one=86400000,t=new Date(startUTC.getTime()+one);
      while(t<=endUTC){ const d=t.getUTCDay(); if(d!==0&&d!==6)c++; t=new Date(t.getTime()+one); }
      return c;
    }

    function render(){
      const date=dateInput.value.trim();
      const label=document.getElementById('label').value.trim();
      const r=diffDaysKST(date);
      if(!r){ alert('ëª©í‘œ ë‚ ì§œë¥¼ YYYY-MM-DD í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•˜ì„¸ìš”.'); return; }
      const {diff,todayUTC,targetUTC}=r;

      const head = diff===0 ? 'D-0 (D-day)' : (diff>0 ? `D-${diff}` : `D+${Math.abs(diff)}`);
      document.getElementById('headline').textContent=head;

      const combined = label ? `${date} (${label})` : date;
      document.getElementById('subline').textContent = combined;

      const weeks = fmtSigned(diff/7)+'ì£¼';
      const months = fmtSigned(diff/30)+'ê°œì›”';
      const biz   = diff>=0 ? countBizForward(todayUTC,targetUTC) : -countBizForward(targetUTC,todayUTC);

      document.getElementById('daysAbs').textContent = `${diff}ì¼`;
      document.getElementById('weeks').textContent   = weeks;
      document.getElementById('months').textContent  = months;
      document.getElementById('bizdays').textContent = `${biz}ì¼`;

      document.getElementById('now').textContent=`ê¸°ì¤€ ì‹œê°: ${fmtNow.format(new Date())} (KST)`;
      document.getElementById('resultWrap').style.display='block';
    }

    function copyTextById(id){
      const txt=document.getElementById(id).textContent.trim();
      navigator.clipboard.writeText(txt).then(()=>{
        const map={ headline:'copyHeadline', subline:'copySubline' };
        const btn = document.getElementById(map[id]) || document.querySelector(`[data-copy="${id}"]`);
        if(btn){ const o=btn.textContent; btn.textContent='âœ…'; setTimeout(()=>btn.textContent=o,900); }
      });
    }

    document.getElementById('calcBtn').addEventListener('click',render);
    document.getElementById('resetBtn').addEventListener('click',()=>{
      document.getElementById('label').value=''; dateInput.value='';
      document.getElementById('resultWrap').style.display='none'; closePicker();
    });
    document.getElementById('copyHeadline').addEventListener('click',()=>copyTextById('headline'));
    document.getElementById('copySubline').addEventListener('click',()=>copyTextById('subline'));
    document.querySelectorAll('[data-copy]').forEach(b=>b.addEventListener('click',()=>copyTextById(b.dataset.copy)));

    document.getElementById('year').textContent=new Date().getFullYear();
    document.getElementById('now').textContent=`ê¸°ì¤€ ì‹œê°: ${fmtNow.format(new Date())} (KST)`;
  </script>
</body>
</html>